
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Documentation for use of EdgeX Foundry" name="description"/>
<meta content="Michael Johanson" name="author"/>
<link href="https://docs.edgexfoundry.org/3.0/design/adr/security/0020-spiffe/" rel="canonical"/>
<link href="../../../../assets/logo_edgex.png" rel="icon"/>
<meta content="mkdocs-1.4.3, mkdocs-material-8.5.8" name="generator"/>
<title>Use SPIFFE/SPIRE for On-demand Secret Store Token Generation - EdgeX Foundry Documentation</title>
<link href="../../../../assets/stylesheets/main.20d9efc8.min.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/palette.815d1a91.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../../assets/stylesheets/version-select.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/branding.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/edgey.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/newexample.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-38531ZZHBN"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-38531ZZHBN",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-38531ZZHBN",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#use-spiffespire-for-on-demand-secret-store-token-generation">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="EdgeX Foundry Documentation" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="EdgeX Foundry Documentation">
<img alt="logo" src="../../../../assets/logo_edgex_white.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            EdgeX Foundry Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Use SPIFFE/SPIRE for On-demand Secret Store Token Generation
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/edgexfoundry/edgex-go" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    edgex/edgex-go
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../..">
        Introduction
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../getting-started/">
        Getting Started
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../security/Ch-Security/">
        Security
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../microservices/general/">
        Microservices
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../examples/">
        Examples and Tutorials
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../api/Ch-APIIntroduction/">
        API Reference
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../Process/">
        Use Cases &amp; Designs
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../general/Definitions/">
        Reference
      </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="EdgeX Foundry Documentation" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="EdgeX Foundry Documentation">
<img alt="logo" src="../../../../assets/logo_edgex_white.png"/>
</a>
    EdgeX Foundry Documentation
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/edgexfoundry/edgex-go" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    edgex/edgex-go
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1">
          Introduction
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Introduction" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
          Introduction
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../..">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../V3TopLevelMigration/">
        V3 Migration Guide
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Getting Started" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/">
        Getting Started
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/quick-start/">
        Quick Start
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3">
          Users
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Users" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
          Users
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedUsers/">
        Getting Started as a User
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedDockerUsers/">
        Getting Started using Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedSnapUsers/">
        Getting Started using Snaps
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4">
          Developers
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Developers" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
          Developers
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedDevelopers/">
        Getting Started as a Developer
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedGoDevelopers/">
        Getting Started - Go Developers
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedCDevelopers/">
        Getting Started - C Developers
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedHybrid/">
        Working in a Hybrid Environment
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4_5" id="__nav_2_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4_5">
          Native Build and Run Guides
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Native Build and Run Guides" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_4_5">
<span class="md-nav__icon md-icon"></span>
          Native Build and Run Guides
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/native/Ch-BuildRunNative/">
        Native Build and Run
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/native/Ch-BuildRunOnLinuxDistro/">
        Build and Run on Linux on x86/x64
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/native/Ch-BuildRunOnArm32/">
        Build and Run on Linux on ARM 32
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/native/Ch-BuildRunOnWindows/">
        Build and Run on Windows on x86/x64
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/ApplicationFunctionsSDK/">
        Application Functions SDK
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4_7" id="__nav_2_4_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4_7">
          Device Services
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Device Services" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_4_7">
<span class="md-nav__icon md-icon"></span>
          Device Services
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedSDK/">
        Device Service SDK
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedSDK-C/">
        C SDK
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedSDK-Go/">
        Golang SDK
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedUsersNexus/">
        Getting Docker Images from EdgeX Nexus Repository
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/Ch-GettingStartedDTOValidation/">
        DTO Validation
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" id="__nav_2_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_5">
          Tools
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Tools" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
          Tools
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/tools/Ch-CommandLineInterface/">
        Command Line Interface (CLI)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../getting-started/tools/Ch-GUI/">
        Graphical User Interface (GUI)
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
          Security
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Security" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Security
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-Security/">
        Security
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-SecretStore/">
        Secret Store
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-Authenticating/">
        Authenticating to EdgeX Microservices
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-SecretProviderApi/">
        Secret Provider API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-APIGateway/">
        API Gateway
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-Secure-MessageBus/">
        Secure MessageBus
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-Configuring-Add-On-Services/">
        Configuring Add-on Service
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-Secure-Consul/">
        Secure Consul
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-SecurityIssues/">
        Reporting Security Issues
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/secrets-config/">
        Secrets config
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/secrets-config-proxy/">
        Secrets config proxy
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/SeedingServiceSecrets/">
        Seeding Service Secrets
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-CORS-Settings/">
        CORS settings
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-DelayedStartServices/">
        Delayed-Start Services
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/Ch-RemoteDeviceServices/">
        Remote Device Services in Secure Mode
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_16" id="__nav_3_16" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_16">
          Threat Models
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Threat Models" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_16">
<span class="md-nav__icon md-icon"></span>
          Threat Models
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../threat-models/secret-store/">
        EdgeX Foundry Secret Management Threat Model
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../threat-models/stride-model/EdgeX-STRIDE/">
        EdgeX Foundry STRIDE Threat Model
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../threat-models/stride-model/EdgeXFoundryThreatReportV2.2/">
        Threat Modeling Report
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../security/V3Migration/">
        V3 Migration Guide
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
          Microservices
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Microservices" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Microservices
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/general/">
        Cross Cutting Concerns
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2">
          Configuration &amp; Registry
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Configuration &amp; Registry" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Configuration &amp; Registry
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/configuration/CommonConfiguration/">
        Service Configuration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/configuration/CommonCommandLineOptions/">
        Command Line Options
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/configuration/CommonEnvironmentVariables/">
        Environment Variables
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/configuration/ConfigurationAndRegistry/">
        Configuration and Registry Providers
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/configuration/V3MigrationCommonConfig/">
        V3 Migration of Common Configuration
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/general/messagebus/">
        EdgeX MessageBus
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4">
          Core Services
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Core Services" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
          Core Services
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/core/Ch-CoreServices/">
        Core Services
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/core/data/Ch-CoreData/">
        Core Data
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/core/metadata/Ch-Metadata/">
        Core Metadata
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/core/command/Ch-Command/">
        Core Command
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/core/database/Ch-Redis/">
        Redis Database
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5">
          Supporting Services
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Supporting Services" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
          Supporting Services
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/support/Ch-SupportingServices/">
        Supporting Services Microservices
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/support/notifications/Ch-AlertsNotifications/">
        Support Notifications
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/support/scheduler/Ch-Scheduler/">
        Support Scheduler
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/support/eKuiper/Ch-eKuiper/">
        eKuiper Rules Engine
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6">
          Devices Services
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Devices Services" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
          Devices Services
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/Ch-DeviceServices/">
        Device Services Microservices
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/profile/Ch-DeviceProfile/">
        Device Profile
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/sdk/Ch-DeviceSDK/">
        Device Services SDK
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_4" id="__nav_4_6_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_4">
          Device SDK API
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Device SDK API" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_6_4">
<span class="md-nav__icon md-icon"></span>
          Device SDK API
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/sdk/SDK-Go-API/">
        Go Device SDK API
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5" id="__nav_4_6_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5">
          Supported Device Services
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Supported Device Services" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_6_5">
<span class="md-nav__icon md-icon"></span>
          Supported Device Services
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/Ch-DeviceServiceList/">
        Supported Device Services List
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_2" id="__nav_4_6_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_2">
          Device Onvif Camera
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Device Onvif Camera" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_4_6_5_2">
<span class="md-nav__icon md-icon"></span>
          Device Onvif Camera
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/General/">
        General
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_2_2" id="__nav_4_6_5_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_2_2">
          Walkthrough
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Walkthrough" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_4_6_5_2_2">
<span class="md-nav__icon md-icon"></span>
          Walkthrough
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/Walkthrough/setup/">
        Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/Walkthrough/deployment/">
        Deployment
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/Walkthrough/general-usage/">
        General Usage
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/Walkthrough/custom-build/">
        Custom Build
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_2_3" id="__nav_4_6_5_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_2_3">
          Supplementary Information
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Supplementary Information" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_4_6_5_2_3">
<span class="md-nav__icon md-icon"></span>
          Supplementary Information
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_2_3_1" id="__nav_4_6_5_2_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_2_3_1">
          ONVIF Protocol
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="ONVIF Protocol" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_4_6_5_2_3_1">
<span class="md-nav__icon md-icon"></span>
          ONVIF Protocol
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/ONVIF-protocol/">
        Onvif Camera Device Service Specifications
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/onvif-user-authentication/">
        Onvif User Authentication
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_2_3_2" id="__nav_4_6_5_2_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_2_3_2">
          Features
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Features" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_4_6_5_2_3_2">
<span class="md-nav__icon md-icon"></span>
          Features
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/custom-metadata-feature/">
        Custom Metadata
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/friendlyname-mac/">
        Friendly Name and MAC Address
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/device-status/">
        Device Status
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/auto-discovery/">
        Auto Discovery
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/credentials/">
        Credentials
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/reboot-needed/">
        RebootNeeded
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_2_3_3" id="__nav_4_6_5_2_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_2_3_3">
          API Reference
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="API Reference" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_4_6_5_2_3_3">
<span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/api-analytic-support/">
        Analytic Support
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/api-event-handling/">
        Event Handling
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/api-usage-user-handling/">
        User Handling
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_2_3_4" id="__nav_4_6_5_2_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_2_3_4">
          Utility
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Utility" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_4_6_5_2_3_4">
<span class="md-nav__icon md-icon"></span>
          Utility
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/test-with-postman/">
        Test with Postman
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/utility-scripts/">
        Utility Scripts
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_2_3_5" id="__nav_4_6_5_2_3_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_2_3_5">
          Miscellaneous
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Miscellaneous" class="md-nav" data-md-level="6">
<label class="md-nav__title" for="__nav_4_6_5_2_3_5">
<span class="md-nav__icon md-icon"></span>
          Miscellaneous
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/control-plane-events/">
        Control Plane Events
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/getting-started-with-docker-security/">
        Getting Started With Docker (Security Mode)
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/ws-discovery/">
        How does WS-Discovery work?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-onvif-camera/supplementary-info/onvif-footnotes/">
        ONVIF Footnotes
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_3" id="__nav_4_6_5_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_3">
          Device USB Camera
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Device USB Camera" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_4_6_5_3">
<span class="md-nav__icon md-icon"></span>
          Device USB Camera
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-usb-camera/General/">
        General
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_3_2" id="__nav_4_6_5_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_3_2">
          Walkthrough
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Walkthrough" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_4_6_5_3_2">
<span class="md-nav__icon md-icon"></span>
          Walkthrough
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-usb-camera/walkthrough/setup/">
        Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-usb-camera/walkthrough/deployment/">
        Deployment
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-usb-camera/walkthrough/general-usage/">
        General Usage
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-usb-camera/walkthrough/custom-build/">
        Custom Build
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_3_3" id="__nav_4_6_5_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_3_3">
          Supplementary Information
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Supplementary Information" class="md-nav" data-md-level="5">
<label class="md-nav__title" for="__nav_4_6_5_3_3">
<span class="md-nav__icon md-icon"></span>
          Supplementary Information
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-usb-camera/supplementary-info/discovery/">
        Dynamic Discovery
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-usb-camera/supplementary-info/advanced-options/">
        Advanced Options
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6_5_4" id="__nav_4_6_5_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6_5_4">
          Device Virtual
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Device Virtual" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_4_6_5_4">
<span class="md-nav__icon md-icon"></span>
          Device Virtual
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/supported/device-virtual/Ch-VirtualDevice/">
        Device Virtual
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/device/V3Migration/">
        V3 Migration Guide
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_7" id="__nav_4_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_7">
          Application Services
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Application Services" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_7">
<span class="md-nav__icon md-icon"></span>
          Application Services
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/ApplicationServices/">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/GettingStarted/">
        Getting Started
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/Triggers/">
        Triggers
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_7_4" id="__nav_4_7_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_7_4">
          Application Functions SDK
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Application Functions SDK" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_7_4">
<span class="md-nav__icon md-icon"></span>
          Application Functions SDK
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/ApplicationFunctionsSDK/">
        App Functions SDK Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/ApplicationServiceAPI/">
        Application Service API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/AppFunctionContextAPI/">
        App Function Context API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/ErrorHandling/">
        Pipeline Function Error Handling
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/BuiltIn/">
        Built-In Pipeline Functions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/AdvancedTopics/">
        Advanced Topics
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/AppServiceConfigurable/">
        App Service Configurable
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/GeneralAppServiceConfig/">
        Application Service Configuration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../microservices/application/V3Migration/">
        V3 Migration Guide
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
          Examples and Tutorials
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Examples and Tutorials" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Examples and Tutorials
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../examples/">
        EdgeX Examples
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../examples/Ch-ExamplesVirtualDeviceService/">
        Using the Virtual Device Service
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../examples/Ch-ExamplesSendingAndConsumingBinary/">
        Sending and Consuming Binary Data From EdgeX Device Services
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../examples/AppServiceExamples/">
        App Service Examples
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../examples/Ch-CommandingDeviceThroughRulesEngine/">
        Command Devices with eKuiper Rules Engine
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../examples/Ch-ExamplesModbusdatatypeconversion/">
        Modbus - Data Type Conversion
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../examples/Ch-OSImageWithEdgeX/">
        Creating an EdgeX OS Image
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_8" id="__nav_5_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_8">
          Adding a Device
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Adding a Device" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_8">
<span class="md-nav__icon md-icon"></span>
          Adding a Device
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../examples/Ch-ExamplesAddingModbusDevice/">
        Modbus
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../examples/Ch-ExamplesAddingSNMPDevice/">
        SNMP
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../examples/Ch-ExamplesAddingMQTTDevice/">
        MQTT
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_9" id="__nav_5_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_9">
          Walkthrough
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Walkthrough" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_9">
<span class="md-nav__icon md-icon"></span>
          Walkthrough
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../walk-through/Ch-Walkthrough/">
        EdgeX Demonstration API Walk Through
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../walk-through/Ch-WalkthroughSetup/">
        Setup up your environment
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../walk-through/Ch-WalkthroughUseCase/">
        Example Use Case
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../walk-through/Ch-WalkthroughDeviceProfile/">
        Defining your device
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../walk-through/Ch-WalkthroughDeviceService/">
        Register your device service
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../walk-through/Ch-WalkthroughProvision/">
        Provision a device
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../walk-through/Ch-WalkthroughCommands/">
        Calling commands
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../walk-through/Ch-WalkthroughReading/">
        Sending events and reading data
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../walk-through/Ch-WalkthroughExporting/">
        Exporting your device data
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
          API Reference
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="API Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../api/Ch-APIIntroduction/">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../api/core/Ch-APICoreCommand/">
        Core Command
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../api/core/Ch-APICoreData/">
        Core Data
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../api/core/Ch-APICoreMetadata/">
        Core Metadata
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../api/core/Ch-APICoreConfigurationAndRegistry/">
        Configuration and Registry
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../api/support/Ch-APISupportNotifications/">
        Support Notifications
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../api/support/Ch-APISupportScheduler/">
        Support Scheduler
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../api/devices/Ch-APIDeviceSDK/">
        Device Services
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../api/applications/Ch-APIAppFunctionsSDK/">
        Application Services
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../api/applications/Ch-APIRulesEngine/">
        Rules Engine
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7">
          Use Cases &amp; Designs
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Use Cases &amp; Designs" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          Use Cases &amp; Designs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../Process/">
        Use Cases and Design Process
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../TOC/">
        Use Cases and Design Records
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" id="__nav_7_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_3">
          Legacy
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Legacy" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_3">
<span class="md-nav__icon md-icon"></span>
          Legacy
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../legacy-design/">
        Legacy Design Documents
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../legacy-requirements/">
        Legacy Requirements
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8">
          Reference
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
          Reference
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../general/Definitions/">
        Definitions
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../general/PlatformRequirements/">
        Platform Requirements
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../general/ServicePorts/">
        Default Service Ports
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../general/ContainerNames/">
        EdgeX Container Names
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../general/ServiceConfiguration/">
        Service Configuration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../general/EdgeX_CN/">
        Is EdgeX Foundry Cloud Native?
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#status">
    Status
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#context">
    Context
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#decision">
    Decision
  </a>
<nav aria-label="Decision" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#technical-architecture">
    Technical Architecture
  </a>
<nav aria-label="Technical Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#workload-registration-and-agent-sockets">
    Workload Registration and Agent Sockets
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#trust-bundle">
    Trust Bundle
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workload-authorization">
    Workload Authorization
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consequences">
    Consequences
  </a>
<nav aria-label="Consequences" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#footprint">
    Footprint
  </a>
<nav aria-label="Footprint" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#spire-server">
    SPIRE Server
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#spire-agent">
    SPIRE Agent
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#spiffe-base-secret-store-token-provider">
    SPIFFE-base Secret Store Token Provider
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#limitations">
    Limitations
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#alternatives">
    Alternatives
  </a>
<nav aria-label="Alternatives" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#overcoming-lack-of-a-supported-grpc-c-library">
    Overcoming lack of a supported GRPC-C library
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#opt-in-or-standard-feature">
    Opt-in or Standard Feature
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#merge-security-file-token-provider-and-security-spiffe-token-provider">
    Merge security-file-token-provider and security-spiffe-token-provider
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#alternatives-regarding-spiffe-ca">
    Alternatives regarding SPIFFE CA
  </a>
<nav aria-label="Alternatives regarding SPIFFE CA" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#transient-ca-option">
    Transient CA option
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#vault-based-ca-option">
    Vault-based CA option
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#references">
    References
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/edgexfoundry/edgex-go/edit/master/docs/design/adr/security/0020-spiffe.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg>
</a>
<h1 id="use-spiffespire-for-on-demand-secret-store-token-generation">Use SPIFFE/SPIRE for On-demand Secret Store Token Generation</h1>
<h2 id="status">Status</h2>
<p><strong> Approved </strong> via TSC vote on 2021-12-14</p>
<h2 id="context">Context</h2>
<p>In security-enabled EdgeX,
there is a component called <code>security-secretstore-setup</code>
that seeds authentication tokens for Hashicorp Vault--EdgeX's secret store--into
directories reserved for each EdgeX microservice.
The implementation is provided by a sub-component, <code>security-file-token-provider</code>,
that works off of a static configuration file (<code>token-config.json</code>)
that configures known EdgeX services,
and an environment variable that lists additional services that require tokens.
The token provider creates a unique token for each service
and attaches a custom policy to each token that limits token access
in a manner that paritions the secret store's namespace.</p>
<p>The current solution has some problematic aspects:</p>
<ul>
<li>
<p>These tokens have an initial TTL of one hour (1h)
  and become invalid if not used and renewed within that time period.
  It is not possible to delay the start of EdgeX services until a later time
  (that is, greater than the default token TTL),
  as they will not be able to connect to the EdgeX secret store
  to obtain required secrets.</p>
</li>
<li>
<p>Transmission of the authentication token requires one or more shared file systems
  between the service and <code>security-secretstore-setup</code>.
  In the Docker implementation,
  this shared file system is constructed by bind-mounting a host-based directory
  to multiple containers.
  The snap implementation is similar, utilizing a content-interface between snaps.
  In a Kubernetes implementation limited to a single worker node,
  a CSI storage driver that provided RWO volumes would suffice.</p>
</li>
<li>
<p>The current approach cannot support distributed services
  without an underlying distributed file system to distribute tokens,
  such as GlusterFS, running across the participating nodes.
  For Kubernetes, the requirement would be a remote shared file system
  persistent volume (RWX volume).</p>
</li>
</ul>
<h2 id="decision">Decision</h2>
<p>EdgeX will create a new service, <code>security-spiffe-token-provider</code>.
This service will be a mutual-auth TLS service that exchanges
a <a href="https://spiffe.io/">SPIFFE</a> X.509 SVID for a secret store token.</p>
<p>An SPIFFE identifier is a URI of the format <code>spiffe://trust domain/workload identifier</code>.
For example: <code>spiffe://edgexfoundry.org/service/core-data</code>.
A SPIFFE Verifiable Identity Document (SVID) is a cryptographically-signed
version of a SPIFFE ID, typically a X.509 certificate with
the SPIFFE ID encoded into the <code>subjectAltName</code> certificate extension,
or a JSON web token (encoded into the <code>sub</code> claim).
The EdgeX implementation will use a naming convention on
the path component, such as the above, in order to be
able to extract the requesting service from the SPIFFE ID.</p>
<p>The SPIFFE token provider will take three parameters:</p>
<ol>
<li>
<p>An X.509 SVID used in mutual-auth TLS for the token provider
   and the service to cross-authenticate.</p>
</li>
<li>
<p>The reqested service key.  If blank, the service key will
   default to the service name encoded in the SVID.
   If the service name follows the pattern <code>device-(name)</code>,
   then the service key must follow the format
   <code>device-(name)</code> or <code>device-name-*</code>.
   If the service name is <code>app-service-configurable</code>,
   then the service key must follow the format <code>app-*</code>.
   (This is an accomodation for the Unix workload attester
   not being able to distingish workloads that are launched
   using the same executable binary.
   Custom app services that support multiple instances
   won't be supported unless they name the executable
   the same as the standard app service binary or
   modify this logic.)</p>
</li>
<li>
<p>A list of "known secret" identifiers that will allow
   new services to request database passwords or
   other "known secrets" to be seeded into their service's
   partition in the secret store.</p>
</li>
</ol>
<p>The <code>go-mod-secrets</code> module will be modified to enable a new mode
whereby a secret store token is obtained by:</p>
<ol>
<li>
<p>Obtaining an X.509 SVID by contacting a local SPIFFE agent's
   workload API on a local Unix domain socket.</p>
</li>
<li>
<p>Connecting to the <code>security-spiffe-token-provider</code> service
   using the X.509 SVID to request a secret store token.</p>
</li>
</ol>
<p>The SPIFFE authentication mode will be an opt-in feature.</p>
<p>The SPIFFE implementation will be user-replaceable;
specifically, the workload API socket will be configurable,
as well as the parsing of the SPIFFE ID.
Reasons for doing so might include: changing the name of
the trust domain in the SPIFFE ID, or moving the SPIFFE
server out of the edge.</p>
<p>This feature is estimated to be a "large" or "extra large"
effort that could be implemented in a single release cycle.</p>
<h3 id="technical-architecture">Technical Architecture</h3>
<p><img alt="SPIFFE Architecture and Workflow" src="../0020-spiffe-architecture.jpg"/></p>
<p>The work flow is as follows:</p>
<ol>
<li>Create a root CA for the SPIFFE user to use for creation of sub-CA's.</li>
<li>The SPIFFE server is started.</li>
<li>The server creates a sub-CA for issuing new identities.</li>
<li>The trust bundle (certificate authority) data is exported from the SPIFFE server
   and stored on a shared volume readable by other EdgeX microservices
   (i.e. the existing secrets volume used for sharing secret store tokens).</li>
<li>A join token for the SPIFFE agent is created using <code>token generate</code>
   and shared to the EdgeX secrets volume.</li>
<li>Workload entries are loaded into the SPIFFE server database,
   using the join-identity of the agent created in the previous step
   as the parent ID of the workload.</li>
<li>The SPIFFE agent is started with the join token
   created in a previous step to add it to the cluster.</li>
<li>Vault is started and <code>security-secret-store-setup</code>
   initializes it and creates an admin token for <code>security-spiffe-token-provider</code> to use.</li>
<li>The <code>security-spiffe-token-provider</code> service is started.
   It obtains an SVID from the SIFFE agent and uses it as a TLS server certificate.</li>
<li>An EdgeX microservice starts and obtains another SVID from the SPIFFE agent
   and uses it as a TLS client certificate to contact the
   <code>security-spiffe-token-provider</code> service.
   The EdgeX microservice uses the trust bundle as a server CA
   to verify the TLS certificate of the remote service.</li>
<li><code>security-spiffe-token-provider</code> verifies the SVID using the trust bundle as client CA
   to verify the client,
   extracts the service key,
   and issues an appropriate Vault service token.</li>
<li>The EdgeX microservice accesses Vault as usual.</li>
</ol>
<h4 id="workload-registration-and-agent-sockets">Workload Registration and Agent Sockets</h4>
<p>The server uses a workload registration Unix domain socket that allows
authorization entries to be added to the authorization database.
This socket is protected by Unix file system permissions to control
who is allowed to add entries to the database.</p>
<p>In this proposal, a subcommand will be added to the EdgeX <code>secrets-config</code>
utility to simplify the process of registering new services
that uses the registration socket above.</p>
<p>The agent uses a workload attesation Unix domain socket that
is open to the world.  This socket is shared via a snap content-interface
of via a shared host bind mount for Docker.  There is one agent per node.</p>
<h4 id="trust-bundle">Trust Bundle</h4>
<p>SVID's must be traceable back to a known issuing authority (certificate authority)
to determine their validity.</p>
<p>In the proposed implementation, we will generate a CA on first boot and store it persistently.
This root CA will be distributed as the trust bundle.
The SPIFFE server will then generate a rotating sub-CA for issuing SVIDs,
and the issued SVID will include both the leaf certificate and the intermediate certificate.</p>
<p>This implementation differs from the default implementation,
which uses a transient CA that is rotated periodically
and that keeps a log of past CA's.
The default implementation is not suitable because only the Kubernetes
reference implementation of the SPIRE server has a notification hook
that is invoked when the CA is rotated.
CA rotation would just result in issuing of SVIDs that are not
trusted by microservices that received only the initial CA.</p>
<p>The SPIFFE implementation is replaceable.
The user is free to replace this default implementation with
potentally a cloud-based SPIFFE server and a cloud-based CA.</p>
<h4 id="workload-authorization">Workload Authorization</h4>
<p>Workloads are authenticated by connecting to the <code>spiffe-agent</code>
via a Unix domain socket, which is capable of identifying
the process ID of the remote client.
The process ID is fed into one of following workload attesters,
which gather additional metadata about the caller:</p>
<ul>
<li>The Unix workload attester gathers UID, GID, path, and SHA-256 hash of the executable.
  The Unix workload attester would be used native services and snaps.</li>
<li>The Docker workload attester gathers container labels
  that are added by docker-compose when the container is launched.
  The Docker workload attester would be used for Docker-based EdgeX deployments.
  An example label is <code>docker:label:com.docker.compose.service:edgex-core-data</code>
  where the service label is the key value in the <code>services</code> section of the <code>docker-compose.yml</code>.
  It is also possible to refer to labels built-in to the container image.</li>
<li>The Kubernetes workload attester gathers a wealth of pod and container metadata.</li>
</ul>
<p>Once authenticated, the metadata is sent to the SPIFFE server
to authorize the workload.</p>
<p>Workloads are authorized via an authorization database
connected to the SPIFFE server.
Supported databases are SQLite (default), PostgreSQL, and MySQL.
Due to startup ordering issues, SQLite will be used.
(Disclaimer: SQlite, according for the
<a href="https://thebottomturtle.io/Solving-the-bottom-turtle-SPIFFE-SPIRE-Book.pdf">Turtle book</a>
is intended for development and test only.
We will use SQlite anyway because because Redis is not supported.)</p>
<p>The only service that needs to be seeded to the database as this time
is <code>security-spiffe-token-provier</code>.  For example:</p>
<div class="highlight"><pre><span></span><code>spire-server<span class="w"> </span>entry<span class="w"> </span>create<span class="w"> </span>-parentID<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">local_agent_svid</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span>-dns<span class="w"> </span>edgex-spiffe-token-provider<span class="w"> </span>-spiffeID<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">svid_service_base</span><span class="si">}</span><span class="s2">/edgex-spiffe-token-provider"</span><span class="w"> </span>-selector<span class="w"> </span><span class="s2">"docker:label:com.docker.compose.service:edgex-spiffe-token-provider"</span>
</code></pre></div>
<p>The above command associates a SPIFFE ID with a <em>selector</em>,
in this case, a container label, and configures a DNS
subjectAltName in the X.509 certificate for server-side TLS.</p>
<p>A snap-based installation of EdgeX would use a <code>unix:path</code> or <code>unix:sha256</code> selector instead.</p>
<p>There are two extension mechanims for authorization additional workloads:</p>
<ol>
<li>Inject a config file or environment variable to authorize additional workloads.
   The container will parse and issue <code>spire-server entry create</code> commands
   for each additional service.</li>
<li>Run the <code>edgex-secrets-config</code> utility
   (that will wrap the <code>spire-server entry create</code> command)
   for ad-hoc authorization of new services.</li>
</ol>
<p>The authorization database is persistent across reboots.</p>
<h2 id="consequences">Consequences</h2>
<p>This proposal will require addition of several new, optional, EdgeX microservices:</p>
<ul>
<li><code>security-spiffe-token-provider</code>, running on the main node</li>
<li><code>spiffe-agent</code>, running on the main node and each remote node</li>
<li><code>spiffe-server</code>, running on the main node</li>
<li><code>spiffe-config</code>, a one-shot service running on the main node</li>
</ul>
<p>Note that like Vault, the recommended SPIFFE configuration is
to run the SPIFFE server on a dedicated node.
If this is a concern, bring your own SPIFFE implementation.</p>
<p>Minor changes will be needed to <code>security-secretstore-setup</code> to preserve
the token-creating-token used by <code>security-file-token-provider</code> so that
it can be used by <code>security-spiffe-token-provider</code>.</p>
<p>The startup flow of the framework will be adjusted as follows:</p>
<ul>
<li>Bootstrap service (original)</li>
<li><code>spiffe-server</code><ul>
<li><code>spiffe-config</code> (can be combined with <code>spifee-server</code>)</li>
<li><code>spiffe-agent</code></li>
</ul>
</li>
<li>Vault service (original)<ul>
<li>Secret store setup service (original)</li>
<li><code>security-spiffe-token-provider</code></li>
<li>Consul (original)</li>
<li>Postgres (original)</li>
</ul>
</li>
</ul>
<p>There is no direct dependency between <code>spiffe-server</code>
and any other microservice.
<code>security-spiffe-token-provider</code> requires an SVID
from <code>spiffe-agent</code> and a Vault admin token.</p>
<p>None of these new services will be proxied via the API gateway.</p>
<p>In the future,
this mechanism may become the default secret store distribution mechanism,
as it eliminates several secrets volumes used to share secrets between
<code>security-secretstore-setup</code> and various EdgeX microservices.</p>
<p>The EdgeX automation will only configure the SPIFEE agent on the main node.
Additional nodes can be manually added by the operator
by obtaining a join token from the main node
and using it to bootstrap a remote node.</p>
<p>SPIFFE/SPIRE has native support for Kubernetes
and can distribute the trust bundle via a Kubernetes
ConfigMap to more easily enable distributed scenarios,
removing a major roadblock to usage of EdgeX
in a Kubernetes environment.</p>
<h3 id="footprint">Footprint</h3>
<p>NOTE: This data is limited by the fact that the
pre-built SPIRE reference binaries are compiled
with CGO enabled.</p>
<h4 id="spire-server">SPIRE Server</h4>
<div class="highlight"><pre><span></span><code>    69 MB executable, dynamically linked
   151 MB inside of a Debian-slim container
    30 MB memory usage, as container
</code></pre></div>
<h4 id="spire-agent">SPIRE Agent</h4>
<div class="highlight"><pre><span></span><code>    33 MB executable, dynamically linked
   114 MB inside of a Debian-slim container
    64 MB memory usage, as container
</code></pre></div>
<h4 id="spiffe-base-secret-store-token-provider">SPIFFE-base Secret Store Token Provider</h4>
<p>The following is the minimum size:
<div class="highlight"><pre><span></span><code>  &gt;  6 MB executable (likely much larger)
  &gt; 29 MB memory usage, as container
</code></pre></div></p>
<h2 id="limitations">Limitations</h2>
<p>The following are known limitations with this proposal:</p>
<ul>
<li>
<p>The capabilities enabled by this solution
  would only be enabled on Linux platforms.
  SIFFE/SPIRE Agent is not available for native Windows
  and pre-built binaries are only avaiable for Linux.
  (It is unclear as to whether other *nix'es are supported.)</p>
</li>
<li>
<p>The capabilities enabled by this solution
  would only be supported for Go-based services.
  The SPIFFE API's are implemented in gRPC,
  which is only ported to C#, C++, Dart, Go,
  Java, Kotlin, Node, Objective-C, PHP, Python, and Ruby.
  Notably, the C language is not supported,
  and the only other EdgeX supported language is Go.</p>
</li>
<li>
<p>That default TTL of an x.509 SVID is one hour.
  As such, all SVID consumers must be capable of
  auto-renewal of SVIDs on both the client
  and server side.</p>
</li>
</ul>
<h2 id="alternatives">Alternatives</h2>
<h3 id="overcoming-lack-of-a-supported-grpc-c-library">Overcoming lack of a supported GRPC-C library</h3>
<ul>
<li>
<p><strong>Leave C-SDK device services behind.</strong>
  In this option, C device services would be unable to participate
  in the delayed-start services architecture.</p>
</li>
<li>
<p><strong>Fork a grpc-c library.</strong>
  Forking a grpc-c library and rehabilitating it is one option.
  There is at least one grpc-c library that has been proven to work,
  but it requires additional features to make it compatible with
  the SPIRE workload agent.  However, the project is extremely large
  and it is unlikely that EdgeX is big enough to carry the project.
  Available libraries include:</p>
</li>
<li>
<p>https://github.com/lixiangyun/grpc-c</p>
<p>This library is several years out-of-date, does not compile
on current Linux distributions without some rework,
and does not pass per-request metadata tags.
Proved to work via manual patching. Not supportable.</p>
</li>
<li>
<p>https://github.com/Juniper/grpc-c</p>
<p>This library is serveral years out-of-date, also does not compile
on current Linux distributiosn without some rework.
Uses hard-coded Unix domain socket paths.
May support per-request metadata tags, but did not test.
Not supportable.</p>
</li>
<li>
<p>https://github.com/HewlettPackard/c-spiffe</p>
<p>This library is yet untested. Rather than a gRPC library,
this library implements the workload API client directly.
Ultimately, this library also wraps the gRPC C++ library,
and statically links to it. There is no benefit to the
EdgeX project to use this library as we can call the
underlying library directly.</p>
</li>
<li>
<p><strong>Hybrid device services.</strong>
  In this model, device services would always be written in Go,
  but in the case where linking to a C language library is required,
  CGO features would be used to invoke native C functions
  from golang. This option would commit the EdgeX project to
  a one-time investment to port the existing C device services
  to the new hybrid model. This option is the best choice if the
  long-term strategy is to end-of-life the C Device SDK.</p>
</li>
<li>
<p><strong>Bridge.</strong>
  In this model, the C++ implementation to invoke the
  SPIFFE/SPIRE workload API would be hidden behind a
  dynamic shared library with C linkage.
  This would require minimal change to the existing C SDK.
  However, the resulting binaries would have be based
  on GLIBC vs MUSL in order to get <code>dlopen()</code> support.
  This will also limit the choice of container base images
  for containerized services.</p>
</li>
<li>
<p><strong>Modernize.</strong>
  In this model, the Device SDK would be rewritten either 
  partially or in-full in C++. Under this model, the
  SPIFFE/SPIRE workload API could be accessed via a
  community-supported C++ GRPC SDK. There are many
  implementation options:</p>
</li>
<li>
<p>A "C++ compilation-switch" where the C SDK could
    be compiled in C-mode or C++-mode with enhanced
    functionality.</p>
</li>
<li>
<p>A C++ extension API.  The original C SDK would
    remain as-is, but if compiling with <code>__cplusplus</code>
    defined, additional API methods would be exposed.
    The SDK could thus be composed of a mixture of
    <code>.c</code> files with C linkage and <code>.cc</code> files with C++ linkage.
    The linker would ultimately determine whether or
    not the C++ runtime library needed to be linked in.</p>
</li>
<li>
<p>Native C++ device SDK with legacy C wrapper facade.</p>
</li>
<li>
<p>Compile existing code in C++ mode, with optional C++ facade.</p>
</li>
</ul>
<h3 id="opt-in-or-standard-feature">Opt-in or Standard Feature</h3>
<p>If one of the following things were to happen,
it would push this proposal "over the edge" from being
an optional opt-in feature to a required standard feature for security:</p>
<ul>
<li>
<p>The "on-demand" method of obtaining a secret store token is
  the default method of obtaining a token for non-core EdgeX services.</p>
</li>
<li>
<p>The "on-demand" method of obtaining a secret store token is
  the default method for all EdgeX services.</p>
</li>
<li>
<p>SPIFFE SVID's become the implementation mechanism for
  microservice-level authentication.
  (Not in scope for this ADR.)</p>
</li>
</ul>
<h3 id="merge-security-file-token-provider-and-security-spiffe-token-provider">Merge security-file-token-provider and security-spiffe-token-provider</h3>
<p>Keeping these as separate executables clearly separates the
on-demand secret store tokens feature as an optional service.
It is possible to combine the services,
but there would need to be a configuration switch
in order to enable the SPIFFE feature.
It would also increase the base executable size to include the extra logic.</p>
<h3 id="alternatives-regarding-spiffe-ca">Alternatives regarding SPIFFE CA</h3>
<h4 id="transient-ca-option">Transient CA option</h4>
<p>The SPIFFE server can be configured with no "upstream authority" (certificate authority),
and the server will periodically generate a new, transient CA,
and keep a bounded history of previous CA's.
A rotating trust bundle only practically works in a Kubernetes environment,
since a configmap can be updated real-time.
For everyone else, we need a static CA that can be pre-distributed to remote nodes.
Thus, this solution was not chosen.</p>
<h4 id="vault-based-ca-option">Vault-based CA option</h4>
<p>The SPIFFE server can be configured to make requests to a Hashicorp Vault
PKI secrets engine to generate intermediate CA certificates for signing SVID's.
This is an option for future integrations,
but is omitted from this proposal due to the jump in implementation complexity
and the desire that the current proposal be on add-on feature.
The current implementation allows the SPIFFE server and Vault to be started
simultaneously.  Using a Vault-based CA would require
a complex interlocking sequence of steps.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/edgexfoundry/edgex-docs/issues/278">Issue to create ADR for handling delayed-start services</a></li>
<li><a href="../../0018-Service-Registry/">0018 Service Registry ADR</a> </li>
<li><a href="https://github.com/edgexfoundry/edgex-docs/pull/377">Service List ADR</a></li>
<li><a href="https://spiffe.io/">SPIFFE</a></li>
<li><a href="https://github.com/spiffe/spiffe/blob/main/standards/SPIFFE.md">SPIFFE ID</a></li>
<li><a href="https://github.com/spiffe/spiffe/blob/main/standards/X509-SVID.md">X.500 SVID</a></li>
<li><a href="https://github.com/spiffe/spiffe/blob/main/standards/JWT-SVID.md">JWT SVID</a></li>
<li><a href="https://thebottomturtle.io/Solving-the-bottom-turtle-SPIFFE-SPIRE-Book.pdf">Turtle book</a></li>
</ul>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright  2022 EdgeX Foundry
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/edgexfoundry" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</a>
<a class="md-social__link" href="https://twitter.com/edgexfoundry" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
<a class="md-social__link" href="https://www.linkedin.com/company/edgexfoundry" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs"], "search": "../../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../../../../assets/javascripts/bundle.d6c3db9e.min.js"></script>
<script src="../../../../assets/javascripts/version-select.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>
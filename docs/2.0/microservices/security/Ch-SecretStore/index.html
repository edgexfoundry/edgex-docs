



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for use of EdgeX Foundry">
      
      
        <link rel="canonical" href="https://edgexfoundry.github.io/edgex-docs/microservices/security/Ch-SecretStore/">
      
      
        <meta name="author" content="Michael Johanson">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/logo_edgex.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">
    
    
      
        <title>Secret Store - EdgeX Foundry Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/version-select.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#secret-store" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://edgexfoundry.github.io/edgex-docs/" title="EdgeX Foundry Documentation" aria-label="EdgeX Foundry Documentation" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="../../../assets/logo_edgex.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              EdgeX Foundry Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Secret Store
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/edgexfoundry/edgex-go/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    edgex/edgex-go
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." class="md-tabs__link">
        Introduction
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../getting-started/" class="md-tabs__link">
          Getting Started
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../core/data/Ch-CoreData/" class="md-tabs__link">
          Microservices
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../examples/Ch-ExamplesProvisionDevice/" class="md-tabs__link">
          Examples and Tutorials
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../api/core/Ch-APICoreCommand/" class="md-tabs__link">
          API Reference
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../design/" class="md-tabs__link">
          Architectural Decision Records
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://edgexfoundry.github.io/edgex-docs/" title="EdgeX Foundry Documentation" class="md-nav__button md-logo">
      
        <img alt="logo" src="../../../assets/logo_edgex.png" width="48" height="48">
      
    </a>
    EdgeX Foundry Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/edgexfoundry/edgex-go/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    edgex/edgex-go
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Users
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Users
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/Ch-GettingStartedUsers/" title="Getting Started - Users" class="md-nav__link">
      Getting Started - Users
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/Ch-GettingStartedDevelopers/" title="Getting Started - Developers" class="md-nav__link">
      Getting Started - Developers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/Ch-GettingStartedGoDevelopers/" title="Get EdgeX Foundry - Go Developers" class="md-nav__link">
      Get EdgeX Foundry - Go Developers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/Ch-GettingStartedHybrid/" title="Working in a Hybrid Environment" class="md-nav__link">
      Working in a Hybrid Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4-4" type="checkbox" id="nav-2-4-4">
    
    <label class="md-nav__link" for="nav-2-4-4">
      Device Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-4-4">
        Device Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/Ch-GettingStartedSDK/" title="Device Service SDK" class="md-nav__link">
      Device Service SDK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/Ch-GettingStartedSDK-C/" title="C SDK" class="md-nav__link">
      C SDK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/Ch-GettingStartedSDK-Go/" title="Golang SDK" class="md-nav__link">
      Golang SDK
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../getting-started/Ch-GettingStartedUsersNexus/" title="Getting Docker Images from EdgeX Nexus Repository" class="md-nav__link">
      Getting Docker Images from EdgeX Nexus Repository
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Microservices
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Microservices
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Core Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Core Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/data/Ch-CoreData/" title="Core Data" class="md-nav__link">
      Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/metadata/Ch-Metadata/" title="Metadata" class="md-nav__link">
      Metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/command/Ch-Command/" title="Command" class="md-nav__link">
      Command
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Supporting Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Supporting Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../support/Ch-SupportingServices/" title="Supporting Services Microservices" class="md-nav__link">
      Supporting Services Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../support/logging/Ch-Logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../support/notifications/Ch-AlertsNotifications/" title="Alerts & Notifications" class="md-nav__link">
      Alerts & Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../support/rulesengine/Ch-RulesEngine/" title="Rules Engine" class="md-nav__link">
      Rules Engine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../support/scheduler/Ch-Scheduling/" title="Scheduling" class="md-nav__link">
      Scheduling
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      System Management
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        System Management
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../system-management/agent/Ch_SysMgmtAgent/" title="System Management Agent (SMA)" class="md-nav__link">
      System Management Agent (SMA)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4" checked>
    
    <label class="md-nav__link" for="nav-3-4">
      Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Ch-Security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Secret Store
      </label>
    
    <a href="./" title="Secret Store" class="md-nav__link md-nav__link--active">
      Secret Store
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#start-the-secret-store" class="md-nav__link">
    Start the Secret Store
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshooting-steps" class="md-nav__link">
    Troubleshooting steps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean-up
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-first-service-volume-platform-volume-initializations" class="md-nav__link">
    Start the first service: volume (platform volume initializations)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-second-service-consul-consul-is-vault-store-backend" class="md-nav__link">
    Start the second service: consul (Consul is Vault store backend)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-third-service-config-seed-platform-configuration-initializations" class="md-nav__link">
    Start the third service: config-seed (platform configuration initializations)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-fourth-service-vault-vault-tool" class="md-nav__link">
    Start the fourth service: vault (Vault tool)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-fifth-service-vault-worker-vault-initunseal-process-and-setups" class="md-nav__link">
    Start the fifth service: vault-worker (Vault init/unseal process and setups)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-consul-web-ui" class="md-nav__link">
    Using Consul Web UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-access-to-consul-container-and-using-consul-cli" class="md-nav__link">
    Shell Access to Consul Container and Using Consul CLI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-secret-store" class="md-nav__link">
    Configuring the Secret Store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-secret-store" class="md-nav__link">
    Using the Secret Store
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1st-alternative-executing-a-shell-session-in-the-active-vault-container-to-run-vault-cli-commands" class="md-nav__link">
    1st alternative: executing a shell session in the active Vault container to run Vault CLI commands.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2nd-alternative-using-the-vault-web-ui" class="md-nav__link">
    2nd alternative: using the Vault Web UI.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3rd-alternative-directly-using-the-vault-http-api-with-curl-commands" class="md-nav__link">
    3rd alternative: directly using the Vault HTTP API with cURL commands.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    See also
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Ch-APIGateway/" title="API Gateway" class="md-nav__link">
      API Gateway
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Ch-AccessEdgeXRESTResources/" title="Access EdgeX REST resources" class="md-nav__link">
      Access EdgeX REST resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Ch-StartingSecurity/" title="Starting security services within EdgeX" class="md-nav__link">
      Starting security services within EdgeX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Ch-SecurityIssues/" title="Security Issues" class="md-nav__link">
      Security Issues
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      Devices Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        Devices Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../device/Ch-DeviceServices/" title="Device Services Microservices" class="md-nav__link">
      Device Services Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../device/profile/Ch-DeviceProfile/" title="Device Profile" class="md-nav__link">
      Device Profile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../device/sdk/Ch-DeviceSDK/" title="Device Services SDK" class="md-nav__link">
      Device Services SDK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../device/virtual/Ch-VirtualDevice/" title="Virtual Device" class="md-nav__link">
      Virtual Device
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6">
    
    <label class="md-nav__link" for="nav-3-6">
      App Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-6">
        App Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../application/Ch-ApplServices/" title="Application Services Microservices" class="md-nav__link">
      Application Services Microservices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../application/Ch-AppServiceConfigurable/" title="App Service Configurable" class="md-nav__link">
      App Service Configurable
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../application/Ch-ApplicationServices/" title="Application Services" class="md-nav__link">
      Application Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../application/Ch-ApplicationFunctionsSDK/" title="App Functions SDK (Golang) - Beta" class="md-nav__link">
      App Functions SDK (Golang) - Beta
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../application/Ch-HTTPTrigger/" title="HTTP Trigger" class="md-nav__link">
      HTTP Trigger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../application/Ch-MessageBusTrigger/" title="Message Bus Trigger" class="md-nav__link">
      Message Bus Trigger
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/Ch-Configuration/" title="Configuration and Registry" class="md-nav__link">
      Configuration and Registry
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Examples and Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Examples and Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/Ch-ExamplesProvisionDevice/" title="Provison a Device - Modbus Example" class="md-nav__link">
      Provison a Device - Modbus Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/Ch-ExamplesModbusdatatypeconversion/" title="Modbus - Data Type Conversion" class="md-nav__link">
      Modbus - Data Type Conversion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/Ch-ExamplesVirtualDeviceService/" title="Using the Virtual Device Service" class="md-nav__link">
      Using the Virtual Device Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/Ch-ExamplesRandomDeviceService/" title="Random Integer Device Service Example" class="md-nav__link">
      Random Integer Device Service Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/Ch-ExamplesSendingAndConsumingBinary/" title="Sending and Consuming Binary Data From EdgeX Device Services" class="md-nav__link">
      Sending and Consuming Binary Data From EdgeX Device Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6" type="checkbox" id="nav-4-6">
    
    <label class="md-nav__link" for="nav-4-6">
      Adding a Device
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-6">
        Adding a Device
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/Ch-ExamplesAddingModbusDevice/" title="Modbus" class="md-nav__link">
      Modbus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/Ch-ExamplesAddingSNMPDevice/" title="SNMP" class="md-nav__link">
      SNMP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../examples/Ch-ExamplesAddingMQTTDevice/" title="MQTT" class="md-nav__link">
      MQTT
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7">
    
    <label class="md-nav__link" for="nav-4-7">
      Walkthrough
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        Walkthrough
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-Walkthrough/" title="EdgeX Demonstration API Walk Through" class="md-nav__link">
      EdgeX Demonstration API Walk Through
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-WalkthroughSetup/" title="Setup up your environment" class="md-nav__link">
      Setup up your environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-WalkthroughRunning/" title="Running EdgeX" class="md-nav__link">
      Running EdgeX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-WalkthroughUseCase/" title="Example Use Case" class="md-nav__link">
      Example Use Case
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-WalkthroughData/" title="Defining your data" class="md-nav__link">
      Defining your data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-WalkthroughDeviceProfile/" title="Defining your device" class="md-nav__link">
      Defining your device
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-WalkthroughDeviceService/" title="Register your Device Service" class="md-nav__link">
      Register your Device Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-WalkthroughProvision/" title="Provision a Device" class="md-nav__link">
      Provision a Device
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-WalkthroughCommands/" title="Calling commands" class="md-nav__link">
      Calling commands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-WalkthroughReading/" title="Sending events and reading data" class="md-nav__link">
      Sending events and reading data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../walk-through/Ch-WalkthroughExporting/" title="Exporting your device data" class="md-nav__link">
      Exporting your device data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      API Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        API Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Core
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Core
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/core/Ch-APICoreCommand/" title="Core Command" class="md-nav__link">
      Core Command
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/core/Ch-APICoreData/" title="Core Data" class="md-nav__link">
      Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/core/Ch-APICoreMetadata/" title="Core Metadata" class="md-nav__link">
      Core Metadata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/core/Ch-APICoreServiceConfiguration/" title="Configuration and Registry" class="md-nav__link">
      Configuration and Registry
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Supporting Services
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Supporting Services
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/supporting/Ch-APISupportingServicesAlerts/" title="Alerts & Notifications" class="md-nav__link">
      Alerts & Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/supporting/Ch-APISupportingServicesLogging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/supporting/Ch-APISupportingServicesRulesEngine/" title="Rules Engine" class="md-nav__link">
      Rules Engine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/supporting/Ch-APISupportingServicesScheduling/" title="Scheduling" class="md-nav__link">
      Scheduling
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/Ch-APIDeviceServicesVirtual/" title="APIs - Device Services - Virtual Device Service" class="md-nav__link">
      APIs - Device Services - Virtual Device Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/Ch-APISystemManagement/" title="APIs - System Management - Agent" class="md-nav__link">
      APIs - System Management - Agent
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Architectural Decision Records
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Architectural Decision Records
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../design/" title="Architecture Decision Records Folder" class="md-nav__link">
      Architecture Decision Records Folder
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      Current Design
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        Current Design
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../design/adr/" title="ADR Table of Contents" class="md-nav__link">
      ADR Table of Contents
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-3" type="checkbox" id="nav-6-3">
    
    <label class="md-nav__link" for="nav-6-3">
      Legacy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-3">
        Legacy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../design/legacy-design/" title="Legacy Design Documents" class="md-nav__link">
      Legacy Design Documents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../design/legacy-requirements/" title="Legacy Requirements" class="md-nav__link">
      Legacy Requirements
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#start-the-secret-store" class="md-nav__link">
    Start the Secret Store
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshooting-steps" class="md-nav__link">
    Troubleshooting steps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean-up
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-first-service-volume-platform-volume-initializations" class="md-nav__link">
    Start the first service: volume (platform volume initializations)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-second-service-consul-consul-is-vault-store-backend" class="md-nav__link">
    Start the second service: consul (Consul is Vault store backend)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-third-service-config-seed-platform-configuration-initializations" class="md-nav__link">
    Start the third service: config-seed (platform configuration initializations)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-fourth-service-vault-vault-tool" class="md-nav__link">
    Start the fourth service: vault (Vault tool)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-fifth-service-vault-worker-vault-initunseal-process-and-setups" class="md-nav__link">
    Start the fifth service: vault-worker (Vault init/unseal process and setups)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-consul-web-ui" class="md-nav__link">
    Using Consul Web UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell-access-to-consul-container-and-using-consul-cli" class="md-nav__link">
    Shell Access to Consul Container and Using Consul CLI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-the-secret-store" class="md-nav__link">
    Configuring the Secret Store
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-secret-store" class="md-nav__link">
    Using the Secret Store
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1st-alternative-executing-a-shell-session-in-the-active-vault-container-to-run-vault-cli-commands" class="md-nav__link">
    1st alternative: executing a shell session in the active Vault container to run Vault CLI commands.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2nd-alternative-using-the-vault-web-ui" class="md-nav__link">
    2nd alternative: using the Vault Web UI.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3rd-alternative-directly-using-the-vault-http-api-with-curl-commands" class="md-nav__link">
    3rd alternative: directly using the Vault HTTP API with cURL commands.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    See also
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/edgexfoundry/edgex-go/edit/master/docs/microservices/security/Ch-SecretStore.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="secret-store">Secret Store</h1>
<p>There are all kinds of secrets used within EdgeX Foundry micro services,
such as tokens, passwords, certificates etc. The secret store serves as
the central repository to keep these secrets. The developers of other
EdgeX Foundry micro services utilize the secret store to create, store
and retrieve secrets relevant to their corresponding micro service. The
communications the between secret store and other micro services are
secured by TLS.</p>
<p>Currently the EdgeX Foundry secret store is implemented with
<a href="https://www.vaultproject.io/">Vault</a>, a HashiCorp open source software
product.</p>
<p>Vault is a tool for securely accessing secrets. A secret is anything
that you want to tightly control access to, such as API keys, passwords,
database credentials, service credentials, or certificates. Vault
provides a unified interface to any secret, while providing tight access
control and multiple authentication mechanisms (token, LDAP, etc.).
Vault adds on key rolling, revocation rules, time-to-live access tokens,
secure storage, Shamir Secret Sharing based unlocking mechanism, high
availability and detailed auditing.</p>
<p>Vault can use several backend systems (filesystem, databases, Consul,
Etcd, S3, Azure, etc.) to securely store every sensitive asset. The
current EdgeX Foundry implementation of Vault is using
<a href="https://www.consul.io/">Consul</a>, another HashiCorp open source software
product. Consul is a distributed service mesh to connect, secure, and
configure services across any runtime platform and public or private
cloud. Consul uses a consensus protocol to provide Consistency as
defined by <a href="https://en.wikipedia.org/wiki/CAP_theorem">CAP</a>. The
consensus protocol is based on <a href="https://ramcloud.stanford.edu/wiki/download/attachments/11370504/raft.pdf">"Raft: In search of an Understandable
Consensus
Algorithm"</a>.
For a visual explanation of Raft, see The <a href="http://thesecretlivesofdata.com/raft">Secret Lives of
Data</a>.</p>
<p>The seamless integration of Vault and Consul provides a strong yet
simple infrastructure to setup a reliable high availability architecture
(Vault failover nodes, Consul Clustering) for the EdgeX Foundry Security
services in production.</p>
<p>The key features of Vault are:</p>
<blockquote>
<ul>
<li><strong>Secure Secret Storage:</strong> Arbitrary key/value secrets can be
    stored in Vault. Vault encrypts these secrets prior to writing
    them to persistent storage, so gaining access to the raw storage
    isn't enough to access your secrets. Authentication mechanisms
    (internal and/or external) and authorizations based upon policies
    provide access management.</li>
<li><strong>Dynamic Secrets:</strong> Vault can generate secrets on-demand for some
    systems, automatically revoking them after the lease is up.</li>
<li><strong>Data Encryption:</strong> Vault can encrypt and decrypt data without
    storing it.</li>
<li><strong>Leasing and Renewal:</strong> All secrets in Vault have a lease
    associated with them (automatic revocation). However, clients can
    renew leases via built-in renew APIs.</li>
<li><strong>Revocation:</strong> Vault has built-in support for secret revocation.
    Single secrets, but also a tree of secrets. Revocation assists in
    key rolling as well as locking down systems in the case of an
    intrusion.</li>
</ul>
</blockquote>
<h2 id="start-the-secret-store">Start the Secret Store</h2>
<p>Start the Secret Store with Docker Compose and a Docker Compose manifest
file. The Docker Compose file named docker-compose-fuji.yml can be found
at these two locations:</p>
<blockquote>
<ul>
<li><a href="https://github.com/edgexfoundry/security-secret-store/blob/fuji/docker-compose-fuji.yml">https://github.com/edgexfoundry/security-secret-store/blob/fuji/docker-compose-fuji.yml</a></li>
<li><a href="https://github.com/edgexfoundry/developer-scripts/blob/master/releases/fuji/compose-files/security/docker-compose-fuji.yml">https://github.com/edgexfoundry/developer-scripts/blob/master/releases/fuji/compose-files/security/docker-compose-fuji.yml</a></li>
</ul>
</blockquote>
<p>This Compose file starts the entire EdgeX Foundry platform including the
security services.</p>
<p>The command to start EdgeX Foundry platform including the Secret Store
and API gateway related services is:</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose up -d
</code></pre></div>


<p>For a pristine run, it is strongly recommended to thoroughly clean up
any Docker artifacts remaining from the current run.</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose down -v
</code></pre></div>


<p>The "down" operation will remove containers, network and adding the -v
option it will also remove persistent volumes:</p>
<div class="codehilite"><pre><span></span><code>Stopping edgex-vault       ... <span class="k">done</span>
Stopping edgex-core-consul ... <span class="k">done</span>
Stopping edgex-files       ... <span class="k">done</span>
Removing edgex-vault-worker ... <span class="k">done</span>
Removing edgex-vault        ... <span class="k">done</span>
Removing edgex-config-seed  ... <span class="k">done</span>
Removing edgex-core-consul  ... <span class="k">done</span>
Removing edgex-files        ... <span class="k">done</span>
Removing network security-secret-store_edgex-network
Removing volume security-secret-store_db-data
Removing volume security-secret-store_log-data
Removing volume security-secret-store_consul-config
Removing volume security-secret-store_consul-data
Removing volume security-secret-store_vault-config
Removing volume security-secret-store_vault-file
Removing volume security-secret-store_vault-logs
</code></pre></div>


<h3 id="troubleshooting-steps">Troubleshooting steps</h3>
<p>For debugging purpose, the Secret Store services can be started
individually with these commands. A pre-requisite being to carefully
follow the invocation sequence in order to avoid any dependency failure.
Lines starting with # (hashtag) are contextual comments to explicit the
purpose of the above corresponding command:</p>
<h4 id="clean-up">Clean-up</h4>
<div class="codehilite"><pre><span></span><code>sh&gt; <span class="nb">cd</span> &lt;path-to-EdgeX-Foundry-Secret-Store&gt;
<span class="c1"># &lt;...&gt;/security-secret-store/</span>

sh&gt; docker-compose down -v

sh&gt; docker-compose ps
<span class="c1"># Check no previous container is running</span>

sh&gt; docker volume ls
<span class="c1"># Check and remove any previous persistent and/or unused volumes</span>
sh&gt; docker volume prune
sh&gt; docker volume rm &lt;volume-name&gt;

sh&gt; docker network ls
<span class="c1"># Check and remove the previous EdgeX Foundry Docker network</span>
sh&gt; docker network rm edgex-network
</code></pre></div>


<h4 id="start-the-first-service-volume-platform-volume-initializations">Start the first service: volume (platform volume initializations)</h4>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose up -d volume
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code>Creating network <span class="s2">&quot;security-secret-store_edgex-network&quot;</span> with driver <span class="s2">&quot;bridge&quot;</span>
Creating volume <span class="s2">&quot;security-secret-store_db-data&quot;</span> with default driver
Creating volume <span class="s2">&quot;security-secret-store_log-data&quot;</span> with default driver
Creating volume <span class="s2">&quot;security-secret-store_consul-config&quot;</span> with default driver
Creating volume <span class="s2">&quot;security-secret-store_consul-data&quot;</span> with default driver
Creating volume <span class="s2">&quot;security-secret-store_vault-config&quot;</span> with default driver
Creating volume <span class="s2">&quot;security-secret-store_vault-file&quot;</span> with default driver
Creating volume <span class="s2">&quot;security-secret-store_vault-logs&quot;</span> with default driver
Creating edgex-files ... <span class="k">done</span>
</code></pre></div>


<h4 id="start-the-second-service-consul-consul-is-vault-store-backend">Start the second service: consul (Consul is Vault store backend)</h4>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose up -d consul
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code>edgex-files is up-to-date
Creating edgex-core-consul ... <span class="k">done</span>
</code></pre></div>


<p>Display and inspect consul service logs: important lines are highlighted</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose logs consul
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Attaching</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">Consul</span><span class="w"> </span><span class="n">agent</span><span class="p">...</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="n">Consul</span><span class="w"> </span><span class="n">agent</span><span class="w"> </span><span class="n">running</span><span class="err">!</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="nl">Version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;v1.1.0&#39;</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="n">Node</span><span class="w"> </span><span class="nl">ID</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;371cbce6-02a8-65f6-ddea-6df5c40a4c50&#39;</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">          </span><span class="n">Node</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;edgex-core-consul&#39;</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">         </span><span class="nl">Datacenter</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;dc1&#39;</span><span class="w"> </span><span class="p">(</span><span class="nl">Segment</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&lt;all&gt;&#39;</span><span class="p">)</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">             </span><span class="nl">Server</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">(</span><span class="nl">Bootstrap</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="p">)</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">        </span><span class="n">Client</span><span class="w"> </span><span class="nl">Addr</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">0.0.0.0</span><span class="o">]</span><span class="w"> </span><span class="p">(</span><span class="nl">HTTP</span><span class="p">:</span><span class="w"> </span><span class="mi">8500</span><span class="p">,</span><span class="w"> </span><span class="nl">HTTPS</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">DNS</span><span class="p">:</span><span class="w"> </span><span class="mi">8600</span><span class="p">)</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">       </span><span class="n">Cluster</span><span class="w"> </span><span class="nl">Addr</span><span class="p">:</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="w"> </span><span class="p">(</span><span class="nl">LAN</span><span class="p">:</span><span class="w"> </span><span class="mi">8301</span><span class="p">,</span><span class="w"> </span><span class="nl">WAN</span><span class="p">:</span><span class="w"> </span><span class="mi">8302</span><span class="p">)</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">            </span><span class="nl">Encrypt</span><span class="p">:</span><span class="w"> </span><span class="nl">Gossip</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="p">,</span><span class="w"> </span><span class="n">TLS</span><span class="o">-</span><span class="nl">Outgoing</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="p">,</span><span class="w"> </span><span class="n">TLS</span><span class="o">-</span><span class="nl">Incoming</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="o">==&gt;</span><span class="w"> </span><span class="nf">Log</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="nl">occurs</span><span class="p">:</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">DEBUG</span><span class="o">]</span><span class="w"> </span><span class="nl">agent</span><span class="p">:</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="ss">&quot;371cbce6-02a8-65f6-ddea-6df5c40a4c50&quot;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">ID</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">raft</span><span class="p">:</span><span class="w"> </span><span class="n">Initial</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="p">(</span><span class="k">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">{Suffrage:Voter ID:371cbce6-02a8-65f6-ddea-6df5c40a4c50 Address:127.0.0.1:8300}</span><span class="o">]</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">raft</span><span class="p">:</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="err">:</span><span class="mi">8300</span><span class="w"> </span><span class="o">[</span><span class="n">Follower</span><span class="o">]</span><span class="w"> </span><span class="n">entering</span><span class="w"> </span><span class="n">Follower</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="p">(</span><span class="nl">Leader</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="p">)</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">serf</span><span class="p">:</span><span class="w"> </span><span class="nl">EventMemberJoin</span><span class="p">:</span><span class="w"> </span><span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="p">.</span><span class="n">dc1</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">serf</span><span class="p">:</span><span class="w"> </span><span class="nl">EventMemberJoin</span><span class="p">:</span><span class="w"> </span><span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">consul</span><span class="p">:</span><span class="w"> </span><span class="n">Adding</span><span class="w"> </span><span class="n">LAN</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w"> </span><span class="p">(</span><span class="nl">Addr</span><span class="p">:</span><span class="w"> </span><span class="n">tcp</span><span class="o">/</span><span class="mf">127.0.0.1</span><span class="err">:</span><span class="mi">8300</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nl">DC</span><span class="p">:</span><span class="w"> </span><span class="n">dc1</span><span class="p">)</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">consul</span><span class="p">:</span><span class="w"> </span><span class="n">Handled</span><span class="w"> </span><span class="k">member</span><span class="o">-</span><span class="k">join</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="ss">&quot;edgex-core-consul.dc1&quot;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">area</span><span class="w"> </span><span class="ss">&quot;wan&quot;</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">agent</span><span class="p">:</span><span class="w"> </span><span class="n">Started</span><span class="w"> </span><span class="n">DNS</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="mf">0.0.0.0</span><span class="err">:</span><span class="mi">8600</span><span class="w"> </span><span class="p">(</span><span class="n">tcp</span><span class="p">)</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">agent</span><span class="p">:</span><span class="w"> </span><span class="n">Started</span><span class="w"> </span><span class="n">DNS</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="mf">0.0.0.0</span><span class="err">:</span><span class="mi">8600</span><span class="w"> </span><span class="p">(</span><span class="n">udp</span><span class="p">)</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">agent</span><span class="p">:</span><span class="w"> </span><span class="n">Started</span><span class="w"> </span><span class="n">HTTP</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="o">[</span><span class="n">::</span><span class="o">]</span><span class="err">:</span><span class="mi">8500</span><span class="w"> </span><span class="p">(</span><span class="n">tcp</span><span class="p">)</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">agent</span><span class="p">:</span><span class="w"> </span><span class="n">started</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="n">syncer</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">WARN</span><span class="o">]</span><span class="w"> </span><span class="nl">raft</span><span class="p">:</span><span class="w"> </span><span class="n">Heartbeat</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="w"> </span><span class="n">reached</span><span class="p">,</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="n">election</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">raft</span><span class="p">:</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="err">:</span><span class="mi">8300</span><span class="w"> </span><span class="o">[</span><span class="n">Candidate</span><span class="o">]</span><span class="w"> </span><span class="n">entering</span><span class="w"> </span><span class="n">Candidate</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">DEBUG</span><span class="o">]</span><span class="w"> </span><span class="nl">raft</span><span class="p">:</span><span class="w"> </span><span class="n">Votes</span><span class="w"> </span><span class="nl">needed</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">DEBUG</span><span class="o">]</span><span class="w"> </span><span class="nl">raft</span><span class="p">:</span><span class="w"> </span><span class="n">Vote</span><span class="w"> </span><span class="n">granted</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mi">371</span><span class="n">cbce6</span><span class="o">-</span><span class="mi">02</span><span class="n">a8</span><span class="o">-</span><span class="mi">65</span><span class="n">f6</span><span class="o">-</span><span class="n">ddea</span><span class="o">-</span><span class="mi">6</span><span class="n">df5c40a4c50</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">term</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="nl">Tally</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">raft</span><span class="p">:</span><span class="w"> </span><span class="n">Election</span><span class="w"> </span><span class="n">won</span><span class="p">.</span><span class="w"> </span><span class="nl">Tally</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">raft</span><span class="p">:</span><span class="w"> </span><span class="n">Node</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mf">127.0.0.1</span><span class="err">:</span><span class="mi">8300</span><span class="w"> </span><span class="o">[</span><span class="n">Leader</span><span class="o">]</span><span class="w"> </span><span class="n">entering</span><span class="w"> </span><span class="n">Leader</span><span class="w"> </span><span class="k">state</span><span class="w"></span>
<span class="n">edgex</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">consul</span><span class="w">  </span><span class="o">|</span><span class="w">     </span><span class="mi">2019</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="mi">13</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="o">[</span><span class="n">INFO</span><span class="o">]</span><span class="w"> </span><span class="nl">consul</span><span class="p">:</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="n">leadership</span><span class="w"> </span><span class="n">acquired</span><span class="w"></span>
</code></pre></div>


<h4 id="start-the-third-service-config-seed-platform-configuration-initializations">Start the third service: config-seed (platform configuration initializations)</h4>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose up -d config-seed
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code>edgex-files is up-to-date
edgex-core-consul is up-to-date
Creating edgex-config-seed ... <span class="k">done</span>
</code></pre></div>


<p>Display and inspect the created container states: important lines are
highlighted</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose ps
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code><span class="err">Name                     Command               State                                      Ports</span>
</code></pre></div>


<blockquote>
<p>---------------------------------------------------------------------------------------------------------------------------------------edgex-config-seed
/bin/sh -c /edgex/cmd/conf ... Exit 0 edgex-core-consul
docker-entrypoint.sh agent ... Up 8300/tcp, 8301/tcp, 8301/udp,
8302/tcp, 8302/udp, 0.0.0.0:8400->8400/tcp, 0.0.0.0:8500->8500/tcp,
0.0.0.0:8600->8600/tcp, 8600/udp edgex-files /bin/sh -c /usr/bin/tail
- ... Up</p>
</blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Line 3: <code>edgex-config-seed</code> service has exited after successful
processing (exit code 0)</p>
</div>
<h4 id="start-the-fourth-service-vault-vault-tool">Start the fourth service: vault (Vault tool)</h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vault will be <strong>uninitialized</strong> and <strong>unsealed</strong> upon success. The
<code>vault-worker</code> service will process the initialization and unsealing
tasks.</p>
</div>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose up -d vault
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code>edgex-files is up-to-date
edgex-core-consul is up-to-date
Creating edgex-vault ... <span class="k">done</span>
</code></pre></div>


<p>Display and inspect "vault" service logs: important lines are
highlighted</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose logs vault
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code><span class="err">Attaching to edgex-vault</span>
<span class="err">edgex-vault        | ==&gt; Vault server configuration:</span>
<span class="err">edgex-vault        |</span>
<span class="err">edgex-vault        |              Api Address: https://edgex-vault:8200</span>
<span class="err">edgex-vault        |                      Cgo: disabled</span>
<span class="err">edgex-vault        |          Cluster Address: https://edgex-vault:8201</span>
<span class="err">edgex-vault        |               Listener 1: tcp (addr: &quot;edgex-vault:8200&quot;, cluster address: &quot;edgex-vault:8201&quot;, tls: &quot;enabled&quot;)</span>
<span class="err">edgex-vault        |                Log Level: info</span>
<span class="err">edgex-vault        |                    Mlock: supported: true, enabled: true</span>
<span class="err">edgex-vault        |                  Storage: consul (HA available)</span>
<span class="err">edgex-vault        |                  Version: Vault v0.10.2</span>
<span class="err">edgex-vault        |              Version Sha: 3ee0802ed08cb7f4046c2151ec4671a076b76166</span>
<span class="err">edgex-vault        |</span>
<span class="err">edgex-vault        | ==&gt; Vault server started! Log data will stream in below:</span>
<span class="err">edgex-vault        |</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Line 4 &amp; 7: Vault <strong>API</strong> endpoint on port 8200 (lines 4 and 7).</p>
<p>Line 7: Vault has <strong>TLS</strong> enabled.</p>
<p>Line 10: Vault backend storage is <strong>Consul</strong>.</p>
</div>
<h4 id="start-the-fifth-service-vault-worker-vault-initunseal-process-and-setups">Start the fifth service: vault-worker (Vault init/unseal process and setups)</h4>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose up -d vault-worker
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code>edgex-files is up-to-date
edgex-core-consul is up-to-date
edgex-vault is up-to-date
Creating edgex-vault-worker ... <span class="k">done</span>
</code></pre></div>


<p>Display and inspect "vault-worker" service logs: important lines are
highlighted</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose logs vault-worker
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code><span class="err">Attaching to edgex-vault-worker</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:42 successful loading the rootCA cert.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:43 {&quot;keys&quot;:[&quot;564b9444eebe28b393c21a4dca1e32835b7dc27f5da03b73d22b666cb20224a9&quot;],&quot;keys_base64&quot;:[&quot;VkuURO6+KLOTwhpNyh4yg1t9wn9doDtz0itmbLICJKk=&quot;],&quot;recovery_keys&quot;:null,&quot;recovery_keys_base64&quot;:null,&quot;root_token&quot;:&quot;01dbbae4-353a-8cdf-8189-4d50e5535a6f&quot;}</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:43 Vault has been initialized successfully.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:43 Vault has been unsealed successfully.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Vault Health Check HTTP Status: 200 OK (StatusCode: 200)</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Verifying Admin policy file hash (SHA256).</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Vault policy file checksum (SHA256): 5ce8d58cf7d931735f6532742f677c109a91a263bcefe9aef73ab2a69f4b43d3</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Reading Admin policy file.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Importing Vault Admin policy.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Import Policy Successfull.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Reading Kong policy file.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Importing Vault Kong policy.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Import Policy Successfull.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Creating Vault Admin token.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Create Token Successfull.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Creating Vault Kong token.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Create Token Successfull.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Successful on reading certificate from v1/secret/edgex/pki/tls/edgex-kong.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Cert&amp;key are not in the secret store yet, will need to upload them.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Load cert&amp;key pair from volume successfully, now will upload to secret store.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Trying to upload cert&amp;key to secret store.</span>
<span class="err">edgex-vault-worker | INFO: 2019/01/13 13:35:48 Successful to add certificate to the secret store.</span>
</code></pre></div>


<p>Display and inspect "vault" service logs: important lines are
highlighted</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose logs vault
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code><span class="err">Attaching to edgex-vault</span>
<span class="err">edgex-vault        | ==&gt; Vault server configuration:</span>
<span class="err">edgex-vault        |</span>
<span class="err">edgex-vault        |              Api Address: https://edgex-vault:8200</span>
<span class="err">edgex-vault        |                      Cgo: disabled</span>
<span class="err">edgex-vault        |          Cluster Address: https://edgex-vault:8201</span>
<span class="err">edgex-vault        |               Listener 1: tcp (addr: &quot;edgex-vault:8200&quot;, cluster address: &quot;edgex-vault:8201&quot;, tls: enabled&quot;)</span>
<span class="err">edgex-vault        |                Log Level: info</span>
<span class="err">edgex-vault        |                    Mlock: supported: true, enabled: true</span>
<span class="err">edgex-vault        |                  Storage: consul (HA available)</span>
<span class="err">edgex-vault        |                  Version: Vault v0.10.2</span>
<span class="err">edgex-vault        |              Version Sha: 3ee0802ed08cb7f4046c2151ec4671a076b76166</span>
<span class="err">edgex-vault        |</span>
<span class="err">edgex-vault        | ==&gt; Vault server started! Log data will stream in below:</span>
<span class="err">edgex-vault        |</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.549Z [INFO ] core: security barrier not initialized</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.551Z [INFO ] core: security barrier not initialized</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.554Z [INFO ] core: security barrier initialized: shares=1 threshold=1</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.575Z [INFO ] core: post-unseal setup starting</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.583Z [INFO ] core: loaded wrapping token key</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.583Z [INFO ] core: successfully setup plugin catalog: plugin-directory=</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.584Z [INFO ] core: no mounts; adding default mount table</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.585Z [INFO ] core: successfully mounted backend: type=kv path=secret/</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.586Z [INFO ] core: successfully mounted backend: type=cubbyhole path=cubbyhole/</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.586Z [INFO ] core: successfully mounted backend: type=system path=sys/</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.586Z [INFO ] core: successfully mounted backend: type=identity path=identity/</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.593Z [INFO ] core: restoring leases</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.593Z [INFO ] rollback: starting rollback manager</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.594Z [INFO ] expiration: lease restore complete</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.596Z [INFO ] identity: entities restored</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.597Z [INFO ] identity: groups restored</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.597Z [INFO ] core: post-unseal setup complete</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.597Z [INFO ] core: core/startClusterListener: starting listener: listener_address=172.19.0.4:8201</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.597Z [INFO ] core: core/startClusterListener: serving cluster requests: cluster_listen_address=172.19.0.4:8201</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.600Z [INFO ] core: root token generated</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.600Z [INFO ] core: pre-seal teardown starting</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.600Z [INFO ] core: stopping cluster listeners</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.600Z [INFO ] core: shutting down forwarding rpc listeners</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:42.600Z [INFO ] core: forwarding rpc listeners stopped</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.099Z [INFO ] core: rpc listeners successfully shut down</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.099Z [INFO ] core: cluster listeners successfully shut down</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.100Z [INFO ] rollback: stopping rollback manager</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.100Z [INFO ] core: pre-seal teardown complete</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.105Z [INFO ] core: vault is unsealed</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.105Z [INFO ] core: entering standby mode</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.109Z [INFO ] core: acquired lock, enabling active operation</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.134Z [INFO ] core: post-unseal setup starting</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.135Z [INFO ] core: loaded wrapping token key</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.135Z [INFO ] core: successfully setup plugin catalog: plugin-directory=</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.137Z [INFO ] core: successfully mounted backend: type=kv path=secret/</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.137Z [INFO ] core: successfully mounted backend: type=system path=sys/</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.137Z [INFO ] core: successfully mounted backend: type=identity path=identity/</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.137Z [INFO ] core: successfully mounted backend: type=cubbyhole path=cubbyhole/</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.141Z [INFO ] core: restoring leases</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.142Z [INFO ] rollback: starting rollback manager</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.142Z [INFO ] expiration: lease restore complete</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.143Z [INFO ] identity: entities restored</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.143Z [INFO ] identity: groups restored</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.144Z [INFO ] core: post-unseal setup complete</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.144Z [INFO ] core: core/startClusterListener: starting listener: listener_address=172.19.0.4:8201</span>
<span class="err">edgex-vault        | 2019-01-13T13:35:43.144Z [INFO ] core: core/startClusterListener: serving cluster requests: cluster_listen_address=172.19.0.4:8201</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Line 18: Vault <strong>initialization</strong> successful.</p>
<p>Line 35: Vault <strong>root token</strong> generated.</p>
<p>Line 44: Vault <strong>unsealing</strong> successful.</p>
<p>Line 50: Vault key/value store <em>secret</em> successfully <strong>mounted</strong>.</p>
<p>Line 60 &amp; 61: Vault successfully <strong>started</strong>.</p>
</div>
<p>Display and inspect the created container states: important lines are
highlighted</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker-compose ps
</code></pre></div>


<p>Sample output:</p>
<div class="codehilite"><pre><span></span><code><span class="err">Name                     Command               State                                     Ports</span>
</code></pre></div>


<blockquote>
<p>---------------------------------------------------------------------------------------------------------------------------------------edgex-config-seed
/bin/sh -c /edgex/cmd/conf ... Exit 0 edgex-core-consul
docker-entrypoint.sh agent ... Up 8300/tcp, 8301/tcp, 8301/udp,
8302/tcp, 8302/udp, 0.0.0.0:8400->8400/tcp, 0.0.0.0:8500->8500/tcp,
0.0.0.0:8600->8600/tcp, 8600/udp edgex-files /bin/sh -c /usr/bin/tail
- ... Up edgex-vault docker-entrypoint.sh serve ... Up
0.0.0.0:8200->8200/tcp edgex-vault-worker ./edgex-vault-worker --ini
... Exit 0</p>
</blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Line 9: <code>edgex-vault-worker</code> service has exited after successful
processing (exit code 0)</p>
</div>
<p>Display and inspect the created container volumes: important lines are
highlighted</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker volume ls
DRIVER              VOLUME NAME
<span class="nb">local</span>               security-secret-store_consul-config
<span class="nb">local</span>               security-secret-store_consul-data
<span class="nb">local</span>               security-secret-store_db-data
<span class="nb">local</span>               security-secret-store_log-data
<span class="nb">local</span>               security-secret-store_vault-config
<span class="nb">local</span>               security-secret-store_vault-file
<span class="nb">local</span>               security-secret-store_vault-logs
</code></pre></div>


<p>Display and inspect the container network
(<code>security-secret-store_edgex-network</code>): important lines are highlighted</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker network ls
NETWORK ID          NAME                                  DRIVER              SCOPE
63227826fbc7        bridge                                bridge              <span class="nb">local</span>
60763abffde3        host                                  host                <span class="nb">local</span>
1d236ab1dbbd        none                                  null                <span class="nb">local</span>
0a7f7266d102        security-secret-store_edgex-network   bridge              <span class="nb">local</span>
</code></pre></div>


<h3 id="using-consul-web-ui">Using Consul Web UI</h3>
<p>For learning and verification purposes one might use the Consul Web UI
interface to gather and double check specific Vault informations.</p>
<p>Consul Web UI endpoint port is exposed by the Docker compose file. EdgeX
Foundry platform uses the Consul default port number 8500. It is
normally not recommended to expose Consul UI port number in production,
at least the UI should not be accessible from outside the platform
environment. However, because all the Vault secrets are encrypted before
being transmitted and stored in the Consul backend, having access to
Consul is not sufficient to access any secrets, the vault data
encryption/decryption key would be absolutely necessary.</p>
<p>Open a Web browser on <code>http://&lt;EdgeX Consul Server&gt;:8500/ui</code>.</p>
<p>On the screenshot below, after selecting <code>SERVICES</code> and <code>Vault</code>, the UI
will show the various Vault status (heartbeat and init/unseal states),
coloring the boxes in green, orange or red depending on the level of
importance (info, warning, error). By clicking each of the right side
status indicators, more information will be accessible in order to
better inspect any situation.</p>
<p><img alt="image" src="../EdgeX-UI-Consul-01.png" /></p>
<p>As a practical example, we are going to navigate the Consul structure
for Vault in order to check if the API Gateway (Kong) TLS certificate
and private key were fetched and stored accordingly during the
<code>vault-worker</code> process.</p>
<p>First select <code>KEY/VALUE</code> menu, and then select <code>vault</code> root structure:</p>
<p><img alt="image" src="../EdgeX-UI-Consul-02.png" /></p>
<p>We are now going to navigate deeper in the <code>vault</code> tree structure to
reach and display the EdgeX Kong TLS assets. Continue by selecting
<code>logical/</code>:</p>
<p><img alt="image" src="../EdgeX-UI-Consul-03.png" />{.align-center width="348px"
height="287px"}</p>
<p>Then select <code>d7809b...</code> an arbitrary UID generated and created by Consul
during Vault registration:</p>
<p><img alt="image" src="../EdgeX-UI-Consul-04.png" />{.align-center width="377px"
height="216px"}</p>
<p>Select <code>edgex/</code>:</p>
<p><img alt="image" src="../EdgeX-UI-Consul-05.png" />{.align-center width="419px"
height="228px"}</p>
<p>Select <code>pki/</code>:</p>
<p><img alt="image" src="../EdgeX-UI-Consul-06.png" />{.align-center width="417px"
height="222px"}</p>
<p>Select <code>tls/</code>:</p>
<p><img alt="image" src="../EdgeX-UI-Consul-07.png" />{.align-center width="418px"
height="237px"}</p>
<p>Select <code>edgex-kong/</code>:</p>
<p><img alt="image" src="../EdgeX-UI-Consul-08.png" />{.align-center width="423px"
height="233px"}</p>
<p>And we are now finally able to display the encrypted Vault secret
containing the API Gateway (Kong) TLS server certificate and its
corresponding private key. As you can see on the screenshot below the
Vault key/value is encrypted and totally opaque to Consul, the Vault
data encryption key (DEK) would be necessary to decrypt these secrets.
Each Vault secret is encrypted before being transmitted to Consul
node(s).</p>
<p><img alt="image" src="../EdgeX-UI-Consul-09.png" /></p>
<h3 id="shell-access-to-consul-container-and-using-consul-cli">Shell Access to Consul Container and Using Consul CLI</h3>
<div class="codehilite"><pre><span></span><code>sh&gt; docker <span class="nb">exec</span> -it -e <span class="nv">PS1</span><span class="o">=</span><span class="s1">&#39;\u@\h:\w \$ &#39;</span> edgex-core-consul sh

root@edgex-core-consul:/ <span class="c1"># consul members</span>
Node               Address         Status  Type    Build  Protocol  DC   Segment
edgex-core-consul  <span class="m">127</span>.0.0.1:8301  alive   server  <span class="m">1</span>.1.0  <span class="m">2</span>         dc1  &lt;all&gt;

root@edgex-core-consul:/ <span class="c1"># consul catalog nodes</span>
Node               ID        Address    DC
edgex-core-consul  e49af36a  <span class="m">127</span>.0.0.1  dc1

root@edgex-core-consul:/ <span class="c1"># consul catalog services</span>
consul
edgex-mongo
vault
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Line 5: Shows the Consul node status <code>alive</code> (1 node in EdgeX default
configuration).</p>
<p>Line 9: Shows the Consul nodes (1 node in EdgeX default configuration).</p>
<p>Lines 12-14: Show the Consul registered services.</p>
</div>
<h2 id="configuring-the-secret-store">Configuring the Secret Store</h2>
<p>Vault server configuration is essentially concentrated in one JSON file
named <code>local.json</code>. This file was prepared during the Vault Docker image
build process. In the eventuality of a change, the Vault server
container should be accessed to then modify the JSON file. The absolute
path being <code>/vault/config/local.json</code>. To reload the new configuration
simply send Vault PID a HUP signal to trigger a configuration reload.</p>
<p>Sample Vault server configuration file:</p>
<div class="codehilite"><pre><span></span><code><span class="n">listener</span> <span class="ss">&quot;tcp&quot;</span> <span class="err">{</span>
<span class="n">address</span> <span class="o">=</span> <span class="ss">&quot;edgex-vault:8200&quot;</span>
<span class="n">tls_disable</span> <span class="o">=</span> <span class="ss">&quot;0&quot;</span>
<span class="n">cluster_address</span> <span class="o">=</span> <span class="ss">&quot;edgex-vault:8201&quot;</span>
<span class="n">tls_min_version</span> <span class="o">=</span> <span class="ss">&quot;tls12&quot;</span>
<span class="n">tls_client_ca_file</span> <span class="o">=</span><span class="ss">&quot;/vault/config/pki/EdgeXFoundryCA/EdgeXFoundryCA.pem&quot;</span>
<span class="n">tls_cert_file</span> <span class="o">=</span><span class="ss">&quot;/vault/config/pki/EdgeXFoundryCA/edgex-vault.pem&quot;</span>
<span class="n">tls_key_file</span> <span class="o">=</span> <span class="ss">&quot;/vault/config/pki/EdgeXFoundryCA/edgex-vault.priv.key&quot;</span>
<span class="err">}</span>

<span class="n">backend</span> <span class="ss">&quot;consul&quot;</span> <span class="err">{</span>
<span class="n">path</span> <span class="o">=</span> <span class="ss">&quot;vault/&quot;</span>
<span class="n">address</span> <span class="o">=</span> <span class="ss">&quot;edgex-core-consul:8500&quot;</span>
<span class="n">scheme</span> <span class="o">=</span> <span class="ss">&quot;http&quot;</span>
<span class="n">redirect_addr</span> <span class="o">=</span> <span class="ss">&quot;https://edgex-vault:8200&quot;</span>
<span class="n">cluster_addr</span> <span class="o">=</span> <span class="ss">&quot;https://edgex-vault:8201&quot;</span>
<span class="err">}</span>

<span class="n">default_lease_ttl</span> <span class="o">=</span> <span class="ss">&quot;168h&quot;</span>
<span class="n">max_lease_ttl</span> <span class="o">=</span> <span class="ss">&quot;720h&quot;</span>
</code></pre></div>


<p>The <code>listener</code> clause refers to Vault server process (port, TLS and
server name), the <code>backend</code> clause refers to the storage backend (i.e.
Consul).</p>
<p>To modify this configuration file, execute a shell session in the
running Vault container:</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker <span class="nb">exec</span> -it -e <span class="nv">PS1</span><span class="o">=</span><span class="s1">&#39;\u@\h:\w \$ &#39;</span> -e <span class="nv">VAULT_CAPATH</span><span class="o">=</span><span class="s1">&#39;/vault/config/pki/EdgeXFoundryCA/EdgeXFoundryCA.pem&#39;</span> edgex-vault sh

root@edgex-vault:/vault <span class="c1"># ls -l</span>
total <span class="m">12</span>
drwxr-xr-x    <span class="m">4</span> vault    vault         <span class="m">4096</span> Jan <span class="m">13</span> <span class="m">13</span>:34 config
drwxr-xr-x    <span class="m">2</span> vault    vault         <span class="m">4096</span> Jun  <span class="m">7</span>  <span class="m">2018</span> file
drwxr-xr-x    <span class="m">2</span> vault    vault         <span class="m">4096</span> Jun  <span class="m">7</span>  <span class="m">2018</span> logs
</code></pre></div>


<p>Pay attention to the <code>VAULT_CAPATH</code> environment variable passed to the
session. This is necessary in order to run succesful Vault CLI command.
Every Vault CLI command is a wrapper of the Vault HTTP API. The Vault
server is configured with TLS using X.509 PKI materials generated and
signed by a local self-signed CA (EdgeXFoundryCA). Therefore, in order
for each Vault CLI command (or to that extent cURL commands) to verify
the Vault server TLS certificate, the self-signing CA root certificate
would have to be known by the CLI command interpreter. This
<code>VAULT_CAPATH</code> variable is checked by every Vault CLI commands,
alternatively each Vault CLI command can specify an option with the same
certificate path if the variable is not set.</p>
<p>The self-signed Root CA certificate path can be found in the Vault
configuration file (see above local.json), with parameter
<code>tls_client_ca_file ="/vault/config/pki/EdgeXFoundryCA/EdgeXFoundryCA.pem"</code>.</p>
<p>The <code>local.json</code> configuration file can be read and modified within the
running container:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&lt;</span><span class="n">root</span><span class="nv">@edgex</span><span class="o">-</span><span class="n">vault</span><span class="o">&gt;</span><span class="err">:</span><span class="o">/</span><span class="n">vault</span><span class="w"> </span><span class="err">\#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">config</span><span class="o">/</span><span class="k">local</span><span class="p">.</span><span class="n">json</span><span class="w"> </span>
<span class="n">listener</span><span class="w"> </span><span class="ss">&quot;tcp&quot;</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;edgex-vault:8200&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="n">tls</span><span class="err">\</span><span class="n">_disable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;0&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="n">cluster</span><span class="err">\</span><span class="n">_address</span><span class="w"> </span><span class="o">=</span><span class="ss">&quot;edgex-vault:8201&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="n">tls</span><span class="err">\</span><span class="n">_min</span><span class="err">\</span><span class="n">_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;tls12&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="n">tls</span><span class="err">\</span><span class="n">_client</span><span class="err">\</span><span class="n">_ca</span><span class="err">\</span><span class="n">_file</span><span class="o">=</span><span class="ss">&quot;/vault/config/pki/EdgeXFoundryCA/EdgeXFoundryCA.pem&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="n">tls</span><span class="err">\</span><span class="n">_cert</span><span class="err">\</span><span class="n">_file</span><span class="o">=</span><span class="ss">&quot;/vault/config/pki/EdgeXFoundryCA/edgex-vault.pem&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="n">tls</span><span class="err">\</span><span class="n">_key</span><span class="err">\</span><span class="n">_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;/vault/config/pki/EdgeXFoundryCA/edgex-vault.priv.key&quot;</span><span class="w"> </span>
<span class="err">}</span><span class="w"></span>

<span class="n">backend</span><span class="w"> </span><span class="ss">&quot;consul&quot;</span><span class="w"> </span><span class="err">{</span><span class="w"> </span>
<span class="k">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;vault/&quot;</span><span class="w"> </span>
<span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;edgex-core-consul:8500&quot;</span><span class="w"> </span>
<span class="n">scheme</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;http&quot;</span><span class="w"> </span>
<span class="n">redirect</span><span class="err">\</span><span class="n">_addr</span><span class="w"> </span><span class="o">=</span><span class="ss">&quot;&lt;https://edgex-vault:8200&gt;&quot;</span><span class="w"> </span>
<span class="n">cluster</span><span class="err">\</span><span class="n">_addr</span><span class="w"> </span><span class="o">=</span><span class="ss">&quot;&lt;https://edgex-vault:8201&gt;&quot;</span><span class="w"> </span>
<span class="err">}</span><span class="w"></span>

<span class="k">default</span><span class="err">\</span><span class="n">_lease</span><span class="err">\</span><span class="n">_ttl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;168h&quot;</span><span class="w"> </span>
<span class="nf">max</span><span class="err">\</span><span class="n">_lease</span><span class="err">\</span><span class="n">_ttl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;720h&quot;</span><span class="w"></span>
</code></pre></div>


<p>A sample Vault CLI command to check Vault status:</p>
<div class="codehilite"><pre><span></span><code>root@edgex-vault:/vault <span class="c1"># vault status</span>
Key             Value
---             -----
Seal Type       shamir
Sealed          <span class="nb">false</span>
Total Shares    <span class="m">1</span>
Threshold       <span class="m">1</span>
Version         <span class="m">0</span>.10.2
Cluster Name    vault-cluster-57b3c4ed
Cluster ID      fe6d18bf-fa9c-0d52-3278-bca0390af023
HA Enabled      <span class="nb">true</span>
HA Cluster      https://edgex-vault:8201
HA Mode         active
</code></pre></div>


<p>All the X.509 PKI materials including the self-signing CA are located
under <code>/vault/config/pki/EdgeXFoundryCA</code>.</p>
<div class="codehilite"><pre><span></span><code>root@edgex-vault:/vault <span class="c1"># ls -l config/pki/EdgeXFoundryCA/</span>
total <span class="m">24</span>
-rw-r--r--    <span class="m">1</span> vault    vault          <span class="m">956</span> Dec  <span class="m">5</span> <span class="m">14</span>:05 EdgeXFoundryCA.pem
-r--------    <span class="m">1</span> vault    vault          <span class="m">306</span> Dec  <span class="m">5</span> <span class="m">14</span>:05 EdgeXFoundryCA.priv.key
-rw-r--r--    <span class="m">1</span> vault    vault          <span class="m">989</span> Dec  <span class="m">5</span> <span class="m">14</span>:05 edgex-kong.pem
-rw-------    <span class="m">1</span> vault    vault          <span class="m">306</span> Dec  <span class="m">5</span> <span class="m">14</span>:05 edgex-kong.priv.key
-rw-r--r--    <span class="m">1</span> vault    vault         <span class="m">1001</span> Dec  <span class="m">5</span> <span class="m">14</span>:05 edgex-vault.pem
-rw-------    <span class="m">1</span> vault    vault          <span class="m">306</span> Dec  <span class="m">5</span> <span class="m">14</span>:05 edgex-vault.priv.key
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Line 3: self-signing root CA certificate.</p>
<p>Line 4: self-signing root CA private key.</p>
<p>Line 5: API Gateway (Kong) TLS server certificate.</p>
<p>Line 6: API Gateway (Kong) TLS server certificate private key.</p>
<p>Line 7: Vault TLS server certificate.</p>
<p>Line 8: Vault TLS server certificate private key.</p>
</div>
<p>The CA name (EdgeXFoundryCA) was defined by the
<a href="https://github.com/edgexfoundry/security-secret-store/tree/master/pkisetup">pkisetup</a>
tool during the Vault image build process. This tool is also responsible
for all the TLS server configuration and creation tasks.</p>
<p>If you are willing to change any of the Vault X.509 PKI assets or
configuration parameters you will have to modify the
<a href="https://github.com/edgexfoundry/security-secret-store/blob/master/pkisetup/pkisetup-vault.json">pkisetup-vault.json</a>
file and rebuild a new Vault Docker image.</p>
<p>Similarly to Vault, each EdgeX Foundry service having a TLS server
certificate and private key had its X.509 PKI assets generated and
signed during the Vault Docker image build process. Therefore, the API
Gateway (Kong) configuration file named
<a href="https://github.com/edgexfoundry/security-secret-store/blob/master/pkisetup/pkisetup-kong.json">pkisetup-kong.json</a>
would have to be modified accordingly. A new Vault Docker image would
have to be built.</p>
<p>The Vault
<a href="https://github.com/edgexfoundry/security-secret-store/blob/master/Dockerfile.vault">Dockerfile</a>
contains the <code>pkisetup</code> executions, see below for a corresponding
excerpt (highlighted lines):</p>
<div class="codehilite"><pre><span></span><code><span class="c"># Create assets folder (needed for unseal key/s, root token and tmp)</span>
<span class="c"># Run CA/Vault and Kong PKI/TLS setups and peform housekeeping tasks</span>
<span class="k">RUN</span> mkdir /vault/config/assets <span class="o">&amp;&amp;</span> <span class="se">\</span>
    chown -R vault:vault /vault <span class="o">&amp;&amp;</span> <span class="se">\</span>
    chmod <span class="m">644</span> /vault/config/local.json <span class="o">&amp;&amp;</span> <span class="se">\</span>
    chmod <span class="m">744</span> pkisetup* <span class="o">&amp;&amp;</span> <span class="se">\</span>
    ./pkisetup --config pkisetup-vault.json <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">echo</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
    ./pkisetup --config pkisetup-kong.json <span class="o">&amp;&amp;</span> <span class="se">\</span>
    chown -R vault:vault /vault/config/pki <span class="o">&amp;&amp;</span> <span class="se">\</span>
rm -f /vault/pkisetup /vault/pkisetup-vault.json /vault/pkisetup-kong.json
</code></pre></div>


<p>EdgeX Foundry Docker environment implements a basic Vault/Consul
architecture that does not provide high availability guaranties. Only
one Consul server and one Vault server will be running. In a more
sophisticated production environment it would be possible to build a
reliable high availability infrastructure regarding Consul and Vault. To
facilitate the setup of a minimal failover architecture the
<code>security-secret-store</code> repository provides a sample folder named
<a href="https://github.com/edgexfoundry/security-secret-store/tree/master/Full-Architecture-Prototype">Full-Architecture-Prototype</a>
that contains necessary materials (scripts, helpers, configurations,
etc.) to achieve that goal.</p>
<p>These samples describe an architecture design with two Vault servers in
failover mode (active/standby), using each one a Consul client, which
subsequently connects to a Consul cluster of 3 nodes (minimal Raft
concensus quorum). The Consul clients and servers (nodes) have redundant
paths.</p>
<h2 id="using-the-secret-store">Using the Secret Store</h2>
<h3 id="1st-alternative-executing-a-shell-session-in-the-active-vault-container-to-run-vault-cli-commands">1st alternative: executing a shell session in the active Vault container to run Vault CLI commands.</h3>
<p>See paragraph <strong>Configuring the Secret Store</strong> to have more details on
the <code>VAULT_CAPATH</code> environment variable.</p>
<p>See HashiCorp Vault API documentation for further details on syntax and
usage (<a href="https://www.vaultproject.io/api/">https://www.vaultproject.io/api/</a>).</p>
<p>Execute a shell session in the running Vault container:</p>
<div class="codehilite"><pre><span></span><code>sh&gt; docker <span class="nb">exec</span> -it -e <span class="nv">PS1</span><span class="o">=</span><span class="s1">&#39;\u@\h:\w \$ &#39;</span> -e <span class="nv">VAULT_CAPATH</span><span class="o">=</span><span class="s1">&#39;/vault/config/pki/EdgeXFoundryCA/EdgeXFoundryCA.pem&#39;</span> edgex-vault sh
</code></pre></div>


<p>Locate the <code>assets</code> folder, and the <code>resp-init.json</code> file:</p>
<div class="codehilite"><pre><span></span><code>root@edgex-vault:/vault <span class="c1"># ls -l config/assets/</span>
total <span class="m">12</span>
-rw-r--r--    <span class="m">1</span> root     root           <span class="m">366</span> Jan <span class="m">13</span> <span class="m">13</span>:35 admin-token.json
-rw-r--r--    <span class="m">1</span> root     root           <span class="m">365</span> Jan <span class="m">13</span> <span class="m">13</span>:35 kong-token.json
-rw-r--r--    <span class="m">1</span> root     root           <span class="m">241</span> Jan <span class="m">13</span> <span class="m">13</span>:35 resp-init.json
</code></pre></div>


<p>Inspect the <code>resp-init.json</code> file to grab the Vault Root Token:</p>
<div class="codehilite"><pre><span></span><code>root@edgex-vault:/vault <span class="c1"># cat config/assets/resp-init.json</span>
<span class="o">{</span>
<span class="s2">&quot;keys&quot;</span>:<span class="o">[</span><span class="s2">&quot;564b9444eebe28b393c21a4dca1e32835b7dc27f5da03b73d22b666cb20224a9&quot;</span><span class="o">]</span>,
<span class="s2">&quot;keys_base64&quot;</span>:<span class="o">[</span><span class="s2">&quot;VkuURO6+KLOTwhpNyh4yg1t9wn9doDtz0itmbLICJKk=&quot;</span><span class="o">]</span>,
<span class="s2">&quot;recovery_keys&quot;</span>:null,
<span class="s2">&quot;recovery_keys_base64&quot;</span>:null,
<span class="s2">&quot;root_token&quot;</span>:<span class="s2">&quot;01dbbae4-353a-8cdf-8189-4d50e5535a6f&quot;</span>
<span class="o">}</span>
</code></pre></div>


<p>Login to Vault using Vault CLI and the gathered Root Token:</p>
<div class="codehilite"><pre><span></span><code>root@edgex-vault:/vault <span class="c1"># vault login 01dbbae4-353a-8cdf-8189-4d50e5535a6f</span>
Success! You are now authenticated. The token information displayed below
is already stored in the token helper. You <span class="k">do</span> NOT need to run <span class="s2">&quot;vault login&quot;</span>
again. Future Vault requests will automatically use this token.

Key                Value
---                -----
token              01dbbae4-353a-8cdf-8189-4d50e5535a6f
token_accessor     4d5eabf7-8710-81b1-b6a4-9ba17fdfdeb7
token_duration     
token_renewable    <span class="nb">false</span>
token_policies     <span class="o">[</span>root<span class="o">]</span>
</code></pre></div>


<p>Perform an introspection <code>lookup</code> on the current token login:</p>
<div class="codehilite"><pre><span></span><code>root@edgex-vault:/vault <span class="c1"># vault token lookup</span>
Key                 Value
---                 -----
accessor            4d5eabf7-8710-81b1-b6a4-9ba17fdfdeb7
creation_time       <span class="m">1547386542</span>
creation_ttl        <span class="m">0</span>
display_name        root
entity_id           n/a
expire_time         &lt;nil&gt;
explicit_max_ttl    <span class="m">0</span>
id                  01dbbae4-353a-8cdf-8189-4d50e5535a6f
meta                &lt;nil&gt;
num_uses            <span class="m">0</span>
orphan              <span class="nb">true</span>
path                auth/token/root
policies            <span class="o">[</span>root<span class="o">]</span>
ttl                 <span class="m">0</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Lines 9 &amp; 10: the Root Token is the only token that has no expiration
enforcement rules (Time to Live TTL counter).</p>
</div>
<p>Perform a check on the current token login to display the corresponding
capabilities (policies):</p>
<div class="codehilite"><pre><span></span><code>root@edgex-vault:/vault <span class="c1"># vault token capabilities 01dbbae4-353a-8cdf-8189-4d50e5535a6f</span>
root
</code></pre></div>


<p>Perform a <code>list</code> request to display the currently mounted secret
backends:</p>
<div class="codehilite"><pre><span></span><code>root@edgex-vault:/vault <span class="c1"># vault secrets list</span>
Path          Type         Accessor              Description
----          ----         --------              -----------
cubbyhole/    cubbyhole    cubbyhole_ad070930    per-token private secret storage
identity/     identity     identity_5397dc2f     identity store
secret/       kv           kv_2362c227           key/value secret storage
sys/          system       system_410e4276       system endpoints used <span class="k">for</span> control, policy and debugging
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Line 5: EdgeX Foundry platform is using the Key/Value secret storage
named <code>secret</code></p>
</div>
<p>Let's drill down into the <code>secret</code> k/v storage and walk through a
predefined hierarchical tree structure (path).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>the <code>pkisetup</code> tool used during the Vault Docker image build process
generates all the related X.509 TLS materials. The <code>vault-worker</code>
service is storing each service materials into Vault using arbitrary
paths, setting up access policies accordingly.</p>
</div>
<p>For example, the API Gateway (Kong) service X.509 TLS materials:</p>
<div class="codehilite"><pre><span></span><code>root@edgex-vault:/vault <span class="c1"># vault list secret</span>
Keys
----
edgex/

root@edgex-vault:/vault <span class="c1"># vault list secret/edgex</span>
Keys
----
pki/

root@edgex-vault:/vault <span class="c1"># vault list secret/edgex/pki</span>
Keys
----
tls/

root@edgex-vault:/vault <span class="c1"># vault list secret/edgex/pki/tls</span>
Keys
----
edgex-kong
</code></pre></div>


<p>Displaying the API gateway (Kong) service X.509 TLS materials (TLS
certificate <code>cert</code> &amp; corresponding private key <code>key</code>):</p>
<div class="codehilite"><pre><span></span><code>root@edgex-vault:/vault <span class="c1"># vault read secret/edgex/pki/tls/edgex-kong</span>
Key                 Value
---                 -----
refresh_interval    168h
cert                -----BEGIN CERTIFICATE-----
MIICrjCCAjWgAwIBAgIQDvZxhmU3nyG4cwXlQesMFDAKBggqhkjOPQQDAzB7MQsw
CQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDVNhbiBGcmFuY2lzY28x
FzAVBgNVBAoTDkVkZ2VYRm91bmRyeUNBMRUwEwYDVQQLEwxFZGdlWEZvdW5kcnkxt
FzAVBgNVBAMTDkVkZ2VYRm91bmRyeUNBMB4XDTE4MTIwNTE0MDUyOFoXDTI4MTIw
NTE0MDUyOFowazELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1T
YW4gRnJhbmNpc2NvMRMwEQYDVQQKEwplZGdleC1rb25nMQ0wCwYDVQQLEwRLb25n
MRMwEQYDVQQDEwplZGdleC1rb25nMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAE2dnb
EboXET1TjzmWKFv3A0wklwNbs9t9JLT0ecpQr64a277UnTAQhgCv2e2/x9EP4eta
gSlz5PCqdAykWW0URIEPSwUKWmx4x1DBwyUD2oDOPsFrywIVEC3DlqQAL6huo4GN
MIGKMA4GA1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggrBgEFBQcDATAMBgNVHRMB
Af8EAjAAMB8GA1UdIwQYMBaAFFX63XbmPNpLceOJYyt2Y+LfW/gxMDQGA1UdEQQt
MCuCCmVkZ2V4LWtvbmeCEGVkZ2V4LWtvbmcubG9jYWyBC2FkbWluQGxvY2FsMAoG
CCqGSM49BAMDA2cAMGQCMCaH3sSKq6nlr6hBJx82wYEiK4slMbySiQZg5mLcwrsQ
tIPGcQ2lgBdQYzI3ymOS5gIwNhpQmo/p3hkoFzA4rxIAZx/GUgZan51JlXW0rpgz
4HerRLe55EmvF10mF7VCGOXe
-----END CERTIFICATE-----
key                 -----BEGIN PRIVATE KEY-----
MIG2AgEAMBAGByqGSM49AgEGBSuBBAAiBIGeMIGbAgEBBDC6BRUXqkJbey765+8b
Oib2qG/jbai2rzp0+NQyJv4ijAyYjJlxhVGggZqPPBy8baqhZANiAATZ2dsRuhcR
PVOPOZYoW/cDTCSXA1uz230ktPR5ylCvrhrbvtSdMBCGAK/Z7b/H0Q/h61qBKXPk
8Kp0DKRZbRREgQ9LBQpabHjHUMHDJQPagM4+wWvLAhUQLcOWpAAvqG4<span class="o">=</span>
-----END PRIVATE KEY-----
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These two key values are in PEM format.</p>
</div>
<h3 id="2nd-alternative-using-the-vault-web-ui">2nd alternative: using the Vault Web UI.</h3>
<p>Open a browser session on <code>https://&lt;EdgeX Vault Server&gt;:8200</code>, accept
the self-signed TLS server certificate and sign-in with the Root Token
(see above <strong>1st alternative</strong> to learn how to fetch this token):</p>
<p><img alt="image" src="../EdgeX-UI-Vault-01.png" />{.align-center width="606px"
height="504px"}</p>
<p>Upper left corner of the current Vault UI session, the sign-out menu
displaying the current token name:</p>
<p><img alt="image" src="../EdgeX-UI-Vault-02.png" />{.align-center width="275px"
height="156px"}</p>
<p>Select the Vault secret backend:</p>
<p><img alt="image" src="../EdgeX-UI-Vault-03.png" />{.align-center}</p>
<p>Navigate the API Gateway (Kong) service X.509 TLS materials path
(edgex/pki/tls/edgex-kong):</p>
<p><img alt="image" src="../EdgeX-UI-Vault-04.png" />{.align-center}</p>
<p>The Vault UI also allows entering Vault CLI commands (see above <strong>1st
alternative</strong>) using an embedded console:</p>
<p><img alt="image" src="../EdgeX-UI-Vault-05.png" />{.align-center}</p>
<h3 id="3rd-alternative-directly-using-the-vault-http-api-with-curl-commands">3rd alternative: directly using the Vault HTTP API with cURL commands.</h3>
<p>See paragraph <strong>Configuring the Secret Store</strong> to have more details on
the <code>--cacert</code> option (identical purpose as the <code>VAULT_CAPATH</code>
environment variable for Vault CLI).</p>
<p>See paragraph <strong>Using the Secret Store</strong> to have more details on
gathering the Vault Root Token (ref:
<code>/vault/config/assets/resp-init.json</code>).</p>
<p>See HashiCorp Vault API documentation for further details on syntax and
usage (<a href="https://www.vaultproject.io/api/">https://www.vaultproject.io/api/</a>).</p>
<p>Displaying (GET) the API gateway (Kong) service X.509 TLS materials (TLS
certificate cert &amp; corresponding private key key):</p>
<div class="codehilite"><pre><span></span><code>curl -s --cacert /vault/config/pki/EdgeXFoundryCA/EdgeXFoundryCA.pem <span class="se">\</span>
    --location <span class="se">\</span>
    --header <span class="s2">&quot;X-Vault-Token: 01dbbae4-353a-8cdf-8189-4d50e5535a6f&quot;</span> <span class="se">\</span>
    --request GET <span class="se">\</span>
    https://edgex-vault:8200/v1/secret/edgex/pki/tls/edgex-kong <span class="p">|</span> jq
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Line 2: the <code>--location</code> option allows following a redirection
(necessary when using a Vault cluster)</p>
<p>Line 5: the Vault API path prefix <code>/v1/secret</code> and the API Gateway X.509
TLS materials k/v <code>/edgex/pki/tls/edgex-kong</code>.</p>
<p>Line 5: the <code>jq</code> tool is a lightweight and flexible command-line JSON
processor (<a href="https://stedolan.github.io/jq/">https://stedolan.github.io/jq/</a>) allowing JSON pretty
printing in the terminal.</p>
</div>
<p>Sample JSON returned:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="nt">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;eaa80a1b-0d31-8d11-6ce1-8d9aa3ac6a19&quot;</span><span class="p">,</span>
<span class="nt">&quot;lease_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="nt">&quot;renewable&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="nt">&quot;lease_duration&quot;</span><span class="p">:</span> <span class="mi">604800</span><span class="p">,</span>
<span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;cert&quot;</span><span class="p">:</span> <span class="s2">&quot;-----BEGIN CERTIFICATE-----\nMIICrjCCAjWgAwIBAgIQDvZxhmU3nyG4cwXlQesMFDAKBggqhkjOPQQDAzB7MQsw\nCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDVNhbiBGcmFuY2lzY28x\nFzAVBgNVBAoTDkVkZ2VYRm91bmRyeUNBMRUwEwYDVQQLEwxFZGdlWEZvdW5kcnkx\nFzAVBgNVBAMTDkVkZ2VYRm91bmRyeUNBMB4XDTE4MTIwNTE0MDUyOFoXDTI4MTIw\nNTE0MDUyOFowazELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1T\nYW4gRnJhbmNpc2NvMRMwEQYDVQQKEwplZGdleC1rb25nMQ0wCwYDVQQLEwRLb25n\nMRMwEQYDVQQDEwplZGdleC1rb25nMHYwEAYHKoZIzj0CAQYFK4EEACIDYgAE2dnb\nEboXET1TjzmWKFv3A0wklwNbs9t9JLT0ecpQr64a277UnTAQhgCv2e2/x9EP4eta\ngSlz5PCqdAykWW0URIEPSwUKWmx4x1DBwyUD2oDOPsFrywIVEC3DlqQAL6huo4GN\nMIGKMA4GA1UdDwEB/wQEAwIFoDATBgNVHSUEDDAKBggrBgEFBQcDATAMBgNVHRMB\nAf8EAjAAMB8GA1UdIwQYMBaAFFX63XbmPNpLceOJYyt2Y+LfW/gxMDQGA1UdEQQt\nMCuCCmVkZ2V4LWtvbmeCEGVkZ2V4LWtvbmcubG9jYWyBC2FkbWluQGxvY2FsMAoG\nCCqGSM49BAMDA2cAMGQCMCaH3sSKq6nlr6hBJx82wYEiK4slMbySiQZg5mLcwrsQ\ntIPGcQ2lgBdQYzI3ymOS5gIwNhpQmo/p3hkoFzA4rxIAZx/GUgZan51JlXW0rpgz\n4HerRLe55EmvF10mF7VCGOXe\n-----END CERTIFICATE-----\n&quot;</span><span class="p">,</span>
    <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;-----BEGIN PRIVATE KEY-----\nMIG2AgEAMBAGByqGSM49AgEGBSuBBAAiBIGeMIGbAgEBBDC6BRUXqkJbey765+8b\nOib2qG/jbai2rzp0+NQyJv4ijAyYjJlxhVGggZqPPBy8baqhZANiAATZ2dsRuhcR\nPVOPOZYoW/cDTCSXA1uz230ktPR5ylCvrhrbvtSdMBCGAK/Z7b/H0Q/h61qBKXPk\n8Kp0DKRZbRREgQ9LBQpabHjHUMHDJQPagM4+wWvLAhUQLcOWpAAvqG4=\n-----END PRIVATE KEY-----\n&quot;</span>
<span class="p">},</span>
<span class="nt">&quot;wrap_info&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="nt">&quot;warnings&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
<span class="nt">&quot;auth&quot;</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Lines 7 &amp; 8: the two key values (TLS certificate <code>cert</code> &amp; corresponding
private key <code>key</code>) are in PEM format
(<a href="https://tools.ietf.org/html/rfc1421">https://tools.ietf.org/html/rfc1421</a>).</p>
</div>
<p>Displaying (LIST) the root key path in the Vault <code>secret</code> backend for
the EdgeX Foudry platform (<code>edgex</code>):</p>
<div class="codehilite"><pre><span></span><code>curl -s --cacert /vault/config/pki/EdgeXFoundryCA/EdgeXFoundryCA.pem <span class="se">\</span>
    --location <span class="se">\</span>
    --header <span class="s2">&quot;X-Vault-Token: 01dbbae4-353a-8cdf-8189-4d50e5535a6f&quot;</span> <span class="se">\</span>
    --request LIST <span class="se">\</span>
    https://edgex-vault:8200/v1/secret <span class="p">|</span> jq
</code></pre></div>


<p>Sample JSON returned:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;request_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0e0ea024-176d-21b3-73cb-99f17729b230&quot;</span><span class="p">,</span>
    <span class="nt">&quot;lease_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;renewable&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;lease_duration&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;keys&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;edgex/&quot;</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="nt">&quot;wrap_info&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;warnings&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nt">&quot;auth&quot;</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>
</code></pre></div>


<p>Displaying (GET) the Vault seal status
(<code>API path: /v1/sys/seal-status</code>):</p>
<div class="codehilite"><pre><span></span><code>curl -s --cacert /vault/config/pki/EdgeXFoundryCA/EdgeXFoundryCA.pem <span class="se">\</span>
    --location <span class="se">\</span>
    --header <span class="s2">&quot;X-Vault-Token: 01dbbae4-353a-8cdf-8189-4d50e5535a6f&quot;</span> <span class="se">\</span>
    --request GET <span class="se">\</span>
    https://edgex-vault:8200/v1/sys/seal-status <span class="p">|</span> jq
</code></pre></div>


<p>Sample JSON returned:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;shamir&quot;</span><span class="p">,</span>
    <span class="nt">&quot;sealed&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;t&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;n&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;progress&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;nonce&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.10.2&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cluster_name&quot;</span><span class="p">:</span> <span class="s2">&quot;vault-cluster-57b3c4ed&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cluster_id&quot;</span><span class="p">:</span> <span class="s2">&quot;fe6d18bf-fa9c-0d52-3278-bca0390af023&quot;</span>
<span class="p">}</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Line 3: Vault is <strong>unsealed</strong> therefore available and ready for
requests.</p>
<p>Line 4 &amp; 5: Vault Shamir Secret Sharing default configuration for EdgeX
Foundry: 1 share with threshold 1 (no sharding).</p>
</div>
<h2 id="see-also">See also</h2>
<p>Some of the command used in implementing security services have
man-style documentation:</p>
<ul>
<li><a href="../security-file-token-provider.1/">security-file-token-provider</a> -
    Generate Vault tokens for EdgeX services</li>
<li><a href="../security-secrets-setup.1/">security-secrets-setup</a> - Creates an
    on-device public-key infrastructure (PKI) to secure microservice
    secret management</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Ch-Security/" title="Security" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Security
              </span>
            </div>
          </a>
        
        
          <a href="../Ch-APIGateway/" title="API Gateway" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                API Gateway
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 EdgeX Foundry
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/edgexfoundry" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/edgexfoundry" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/edgexfoundry" target="_blank" rel="noopener" title="linkedin" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../assets/javascripts/version-select.js"></script>
      
    
  </body>
</html>